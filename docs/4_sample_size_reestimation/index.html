<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Alex Kaizer - Sample Size Re-Estimation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/academicons-1.9.2/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/academicons-1.9.2/size.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/academicons-1.9.1/css/academicons.css" rel="stylesheet">

<link rel="icon" type="image/png" href="./files/favicon.ico">

<script type="text/javascript">
function setBrand() {
document.getElementsByClassName("navbar-brand")[0].href="https://www.alexkaizer.com";
}
window.onload = setBrand;
</script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5PBG7BL207"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5PBG7BL207');
</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Alex Kaizer</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-short-course" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Short Course</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-short-course">    
        <li>
    <a class="dropdown-item" href="../0_intro" rel="" target="">
 <span class="dropdown-text">Intro and Welcome</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../1_intro_clinical_trials" rel="" target="">
 <span class="dropdown-text">Basics of Clinical Trials</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../2_intro_bayesian" rel="" target="">
 <span class="dropdown-text">Bayesian 101</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../3_interim_monitoring" rel="" target="">
 <span class="dropdown-text">Interim Monitoring</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../4_sample_size_reestimation" rel="" target="">
 <span class="dropdown-text">Sample Size Re-Estimation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../5_adaptive_enrichment" rel="" target="">
 <span class="dropdown-text">Adaptive Enrichment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../6_treatment_arm_selection" rel="" target="">
 <span class="dropdown-text">Treatment Arm Selection</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../7_adaptive_randomization" rel="" target="">
 <span class="dropdown-text">Adaptive Randomization</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../8_bayesian_information_sharing" rel="" target="">
 <span class="dropdown-text">Bayesian Information Sharing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../9_master_protocols" rel="" target="">
 <span class="dropdown-text">Master Protocols</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../10_seamless_designs" rel="" target="">
 <span class="dropdown-text">Seamless Designs</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:alex.kaizer@cuanschutz.edu" rel="" target=""><i class="bi bi-envelope" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=ICpH74EAAAAJ&amp;hl=en" rel="" target="">
 <span class="menu-text"><i class="ai  ai-google-scholar ai-large"></i></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="http://github.com/alexbiostats" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.alexkaizer.com/files/Alex_CV.pdf" rel="" target="">
 <span class="menu-text"><i class="ai  ai-cv ai-large"></i></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/alex-kaizer/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#slide-deck" id="toc-slide-deck" class="nav-link" data-scroll-target="#slide-deck">Slide Deck</a></li>
  <li><a href="#code-examples-in-r" id="toc-code-examples-in-r" class="nav-link" data-scroll-target="#code-examples-in-r">Code Examples in R</a>
  <ul class="collapse">
  <li><a href="#blinded-example-with-binary-outcome" id="toc-blinded-example-with-binary-outcome" class="nav-link" data-scroll-target="#blinded-example-with-binary-outcome">Blinded Example with Binary Outcome</a></li>
  <li><a href="#unblinded-conditional-power-example-with-binary-outcome" id="toc-unblinded-conditional-power-example-with-binary-outcome" class="nav-link" data-scroll-target="#unblinded-conditional-power-example-with-binary-outcome">Unblinded Conditional Power Example with Binary Outcome</a></li>
  </ul></li>
  <li><a href="#simulation-study" id="toc-simulation-study" class="nav-link" data-scroll-target="#simulation-study">Simulation Study</a>
  <ul class="collapse">
  <li><a href="#blinded-re-estimation-with-binary-outcome-simulation" id="toc-blinded-re-estimation-with-binary-outcome-simulation" class="nav-link" data-scroll-target="#blinded-re-estimation-with-binary-outcome-simulation">Blinded Re-estimation with Binary Outcome Simulation</a></li>
  <li><a href="#unblinded-re-estimation-with-binary-outcome-simulation" id="toc-unblinded-re-estimation-with-binary-outcome-simulation" class="nav-link" data-scroll-target="#unblinded-re-estimation-with-binary-outcome-simulation">Unblinded Re-estimation with Binary Outcome Simulation</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Sample Size Re-Estimation</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="overview" class="level1">
<h1>Overview</h1>
<p>Oftentimes our power calculations represent our best guess at a realistic treatment effect, but even using previous studies or extensive clinical/scientific background can still result in uncertainty. In this module we discuss how we can incorporate re-estimation procedures during the trial to better ensure we enroll sufficient participants to detect the observed effect.</p>
</section>
<section id="slide-deck" class="level1">
<h1>Slide Deck</h1>
<iframe class="speakerdeck-iframe" style="border: 0px; background: rgba(0, 0, 0, 0.1) padding-box; margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 315;" frameborder="0" src="https://speakerdeck.com/player/4664c44f42e147b1bebe71608bda8c88" title="Sample Size Re-Estimation" allowfullscreen="true" data-ratio="1.7777777777777777">
</iframe>
<p>&nbsp;</p>
<p>You can also download the <a href="../files/Slides/4_sample_size_reestimation.pptx">original PowerPoint file</a>.</p>
</section>
<section id="code-examples-in-r" class="level1">
<h1>Code Examples in R</h1>
<p>A selection of packages that may be helpful in implementing a re-estimation procedure include:</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/blindrecalc/index.html"><code>blindrecalc</code></a>: a package for <em>blinded</em> sample re-estimation based on estimating nuisance parameters</li>
<li><a href="https://www.rpact.org/"><code>rpact</code></a>: a package for confirmatory adaptive clinical trial design, simulation, and analysis; includes functions for combination testing for use in unblinded designs</li>
<li><a href="https://keaven.github.io/gsDesign/"><code>gsDesign</code></a>: includes the <code>ssrCP()</code> function for unblinded re-estimation based on conditional power</li>
<li><a href="https://cran.r-project.org/web/packages/esDesign/"><code>esDesign</code></a>: looks at adaptive enrichment designs with sample size re-estimation</li>
</ul>
<section id="blinded-example-with-binary-outcome" class="level2">
<h2 class="anchored" data-anchor-id="blinded-example-with-binary-outcome">Blinded Example with Binary Outcome</h2>
<p>In our first example we observe how the <code>blindrecalc</code> package can be used for a study with a binary outcome. We will use a chi-squared test as our motivating example, largely following the steps from their helpful <a href="https://journal.r-project.org/articles/RJ-2022-001/RJ-2022-001.pdf">R Journal paper</a>.</p>
<p>First we set up our design as the chi-squared test using <code>setupChiSquare()</code>. In this example we are testing a one-sided hypothesis where <span class="math inline">\(H_1\colon p_1 &gt; p_2\)</span> with <span class="math inline">\(\alpha=0.025\)</span>, <span class="math inline">\(\beta=0.2\)</span> (i.e., power of 80%), and we are interested in detecting a difference between two groups of 20% (i.e., <span class="math inline">\(\delta=0.2\)</span>).</p>
<p>We can then estimate the number needed in a fixed sample design using <code>n_fix()</code>. Here the nuisance parameter represents the average of the two groups. We can then estimate the <span class="math inline">\(N\)</span> needed overall with <span class="math inline">\(N/2\)</span> in each randomized group to detect a difference of 20%.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(blindrecalc)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare basic functions</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">setupChiSquare</span>(<span class="at">alpha =</span> <span class="fl">0.025</span>, <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="at">delta =</span> <span class="fl">0.2</span>, <span class="at">alternative =</span> <span class="st">"greater"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">n_fix</span>(design, <span class="at">nuisance =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 124 164 186 194</code></pre>
</div>
</div>
<p>We can verify these sample sizes are analogous to the <code>power.prop.test()</code> function in base R:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Check that power.prop.test matches n_fix (which it does)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">## round up N for each group, multiple by 2 to match overall sample size from n_fix</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># nuisance 0.2</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.1</span>,<span class="at">p2=</span><span class="fl">0.3</span>,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># nuisance 0.3</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.2</span>,<span class="at">p2=</span><span class="fl">0.4</span>,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># nuisance 0.4</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>a3 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.3</span>,<span class="at">p2=</span><span class="fl">0.5</span>,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># nuisance 0.5</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>a4 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.4</span>,<span class="at">p2=</span><span class="fl">0.6</span>,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># print sample sizes</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(a1,a2,a3,a4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 124 164 186 194</code></pre>
</div>
</div>
<p>Let’s focus on the <code>nusiance=0.2</code> case. We can examine the impact on our design if we observe other nuisance parameters even though we anticipated 0.2. The <code>toer()</code> function allows us to estimate the type I error rate we may encounter if we do or do not use blinded re-estimation:</p>
<div class="cell" data-hash="index_cache/html/toer-blindrecalc_1a9101a7be4ea871ec4743e7a5409d8d">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">setupChiSquare</span>(<span class="at">alpha =</span> <span class="fl">0.025</span>, <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="at">delta =</span> <span class="fl">0.2</span>, <span class="at">alternative =</span> <span class="st">"greater"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">n_fix</span>(design, <span class="at">nuisance =</span> <span class="fl">0.2</span>) <span class="co"># N = 124 total (62 per group)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>toer_fix <span class="ot">&lt;-</span> <span class="fu">toer</span>(design, <span class="at">n1 =</span> n, <span class="at">nuisance =</span> p, <span class="at">recalculation =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>toer_ips <span class="ot">&lt;-</span> <span class="fu">toer</span>(design, <span class="at">n1 =</span> n<span class="sc">/</span><span class="dv">2</span>, <span class="at">nuisance =</span> p, <span class="at">recalculation =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>t1e_tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>( <span class="st">"No SSR"</span> <span class="ot">=</span> toer_fix, <span class="st">"SSR at 1/2 Enrolled"</span> <span class="ot">=</span> toer_ips)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(t1e_tab) <span class="ot">&lt;-</span> p</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>t1e_tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                           0.2        0.3        0.4        0.5        0.6
No SSR              0.02366058 0.02484306 0.02701163 0.02943799 0.02701163
SSR at 1/2 Enrolled 0.02544561 0.02536076 0.02484492 0.02565171 0.02484492</code></pre>
</div>
</div>
<p>By comparing these type I error rates, we see that there can be an inflation to our desired <span class="math inline">\(\alpha=0.025\)</span> due to observing different averages between our two groups (i.e., the nuisance parameters reflected by the column headers). With blinded SSR, we see better control of the type I error rate.</p>
<p>We can use the similar <code>pow()</code> to estimate the power under our design with varying nuisance parameters:</p>
<div class="cell" data-hash="index_cache/html/pow-blindrecalc_a9a4cadf1b3b8d19777e0654a3f587a2">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pow_fix <span class="ot">&lt;-</span> <span class="fu">pow</span>(design, <span class="at">n1 =</span> n, <span class="at">nuisance =</span> p, <span class="at">recalculation =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>pow_ips <span class="ot">&lt;-</span> <span class="fu">pow</span>(design, <span class="at">n1 =</span> n<span class="sc">/</span><span class="dv">2</span>, <span class="at">nuisance =</span> p, <span class="at">recalculation =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>pow_tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>( <span class="st">"No SSR"</span> <span class="ot">=</span> pow_fix, <span class="st">"SSR at 1/2 Enrolled"</span> <span class="ot">=</span> pow_ips)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pow_tab) <span class="ot">&lt;-</span> p</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>pow_tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                          0.2       0.3      0.4       0.5      0.6
No SSR              0.8100375 0.6892655 0.641467 0.6381293 0.641467
SSR at 1/2 Enrolled 0.7871930 0.7933507 0.794409 0.7994804 0.794409</code></pre>
</div>
</div>
<p>For power we see that SSR maintains approximately 80% power, but without SSR the power decreases as or nuisance parameter grows.</p>
<p>We can also plot the distribution of sample sizes that would occur at different nuisance parameters to evaluate our potential risk of having a much larger sample size:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">n_dist</span>(design, <span class="at">n1 =</span> n<span class="sc">/</span><span class="dv">2</span>, <span class="at">nuisance =</span> p, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>         p = 0.2  p = 0.3  p = 0.4  p = 0.5  p = 0.6
Min.     62.0000  78.0000 122.0000 154.0000 122.0000
1st Qu. 104.0000 148.0000 178.0000 192.0000 178.0000
Median  122.0000 166.0000 188.0000 194.0000 188.0000
Mean    122.1816 160.6994 184.1047 191.8221 184.1047
3rd Qu. 136.0000 174.0000 192.0000 194.0000 192.0000
Max.    184.0000 194.0000 194.0000 194.0000 194.0000</code></pre>
</div>
</div>
<p>In this figure above we see that if our nuisance parameter is actually 0.2 as assumed for the power calculation, or sample size re-estimation could range from 62 to 184 versus our planned <span class="math inline">\(N=124\)</span>. However, this does assume we allow for sample size reductions and have no limit on the maximum increase. If our guess of the nuisance parameter is 0.5, we see the largest increase in our expected sample size up to 191.8, with a range of 154 to 194.</p>
</section>
<section id="unblinded-conditional-power-example-with-binary-outcome" class="level2">
<h2 class="anchored" data-anchor-id="unblinded-conditional-power-example-with-binary-outcome">Unblinded Conditional Power Example with Binary Outcome</h2>
<p>The <code>gsDesign</code> package includes the <code>ssrCP()</code> which allows us to implement an <em>unblinded</em> sample size re-estimation procedure. Here we continue our previous example using a binary outcome. In this case we will incorporate traditional group sequential O’Brien-Fleming boundaries for interim monitoring for efficacy. This means our sample size will also be adjusted relative to a fixed design to account for the use of the traditional GSD (this is in contrast to alpha-spending boundaries that are OBF-like, where the sample size remains fixed).</p>
<p>First, we must establish the design type based on the <code>gsDesign()</code> function before extending to a conditional power design with <code>ssrCP()</code>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gsDesign) <span class="co"># load package</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">gsDesign</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">2</span>, <span class="co"># number of analyses planned, including interim and final</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.fix =</span> <span class="dv">196</span>, <span class="co"># sample size for a fixed design with no interim</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">timing =</span> <span class="fl">0.5</span>, <span class="co"># timing of interm analyses </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">test.type=</span><span class="dv">2</span>, <span class="co"># 6 options covering one- vs. two-sided and symmetric vs. asymmetric boundaries; 2 is a two-sided symmetric approach</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.025</span>, <span class="co"># one-sided type I error rate</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="co"># type II error rate (i.e., power=1-beta)</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">delta0 =</span> <span class="dv">0</span>, <span class="co"># null hypothesis parameter (i.e., no difference)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">delta1 =</span> <span class="fl">0.2</span>, <span class="co"># alternative hypothesis parameter (i.e., difference we wish to detect)</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">sfu=</span><span class="st">'OF'</span> ) <span class="co"># alpha-spending for efficacy monitoring</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># plot stopping boundaries</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot shows our stopping boundaries for our two-sided test, with the final critical value being 1.98 (versus 1.96 in a fixed design without interim monitoring), as well as an increase from <span class="math inline">\(N=196\)</span> to <span class="math inline">\(N=198\)</span>.</p>
<p>We can then extend this design to a conditional power design based on an observed test statistic at the end of our first stage. Here we assume we observed <span class="math inline">\(Z=1.6\)</span>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extend design to a conditional power design</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">ssrCP</span>(<span class="at">x =</span> x, <span class="co"># provide design used</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">z1 =</span> <span class="fl">1.6</span>, <span class="co"># enter observed test statistic</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">overrun =</span> <span class="dv">0</span>, <span class="co"># can note how many participants are enrolled but not included in the interim analysis</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="co"># targeted type II error for SSR (i.e., targeted power=1-beta)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">cpadj =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.8</span>), <span class="co"># range of conditional powers for which SSR is to be performed, otherwise N from original design used</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">maxinc =</span> <span class="dv">2</span>, <span class="co"># argument limiting maximum fold-increase from planned max N (e.g., 2 times)</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">z2 =</span> z2NC) <span class="co"># combination function to combine stage 1 and stage 2 results; z2NC=inverse normal combination test, z2Z=sufficient stat for complete data, z2Fisher=Fisher's combination test</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># show immediately relevant information</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>dat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   z1      z2       n2        CP     theta      delta
1 1.6 1.19651 259.0207 0.6567062 0.1609988 0.03219977</code></pre>
</div>
</div>
<p>From the <code>ssrCP</code> documentation, we see these values represent:</p>
<ul>
<li>z1: input z1 values,</li>
<li>z2: computed cutoffs for the standard normal test statistic based solely on stage 2 data</li>
<li>n2: stage 2 sample size (however, based on other functions I believe this may be the maximum sample size to enroll, so we need to take n2-n1)</li>
<li>CP: stage 2 conditional power</li>
<li>theta: standardize effect size used for conditional power calculation</li>
<li>delta: the natural parameter value corresponding to theta The relation between theta and delta is determined by the delta0 and delta1 values from x: delta = delta0 + theta(delta1-delta0).</li>
</ul>
<p>The most important summary is the re-estimated sample size of <span class="math inline">\(N=259.0207\)</span> which rounds up to <span class="math inline">\(N=260\)</span>, resulting in a need to enroll <span class="math inline">\(N_2=260-99=161\)</span> in stage 2 instead of the original <span class="math inline">\(N_2 = 198-99=99\)</span>. Overall, this results in a total sample size of <span class="math inline">\(N_1+N_2=99+161=260\)</span>, which is less than the two times inflation allowed by <code>maxinc=2</code> (i.e., up to <span class="math inline">\(198\times2 = 396\)</span> is allowed).</p>
<p>The other useful summary is the <code>z2=1.19651</code>, which represents that we need to observe a test statistic at least this large for our inverse normal combination test to be significant.</p>
<p>If we assume we enroll the 161 additional participants and observe <span class="math inline">\(Z_2=1.3\)</span>, we would have a normal combination test of</p>
<p>[ = = 2.05 &gt; 1.96 = Z_{0.975} = Z_{1-/2} ]</p>
<p>Therefore, we would reject the null hypothesis and conclude we found an effect.</p>
</section>
</section>
<section id="simulation-study" class="level1">
<h1>Simulation Study</h1>
<p>For our simulation study, let’s assume we are interested in designing a study where we wish to reduce the rate of an adverse event by exploring a new approach to a procedure:</p>
<ul>
<li><span class="math inline">\(H_0\colon p_1 = p_2\)</span> versus <span class="math inline">\(H_1\colon p_1 &lt; p_2\)</span> (i.e., one-sided hypothesis)</li>
<li><span class="math inline">\(p_1 = p_{trt} = 0.1\)</span> and <span class="math inline">\(p_2 = p_{con} = 0.25\)</span> for our alternative hypothesis of interest (i.e., reducing the rate of adverse events from 25% to 10%)</li>
<li><span class="math inline">\(\alpha=0.025\)</span></li>
<li><span class="math inline">\(\beta=0.8\)</span></li>
</ul>
<p>For a fixed sample design, using <code>power.prop.test()</code>, we can identify our sample size to enroll:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.1</span>,<span class="at">p2=</span><span class="fl">0.25</span>,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
     Two-sample comparison of proportions power calculation 

              n = 99.54016
             p1 = 0.1
             p2 = 0.25
      sig.level = 0.025
          power = 0.8
    alternative = one.sided

NOTE: n is number in *each* group</code></pre>
</div>
</div>
<p>Given <span class="math inline">\(n=100\)</span> per arm, we would plan for a study enrolling a total of <span class="math inline">\(N_{total}=200\)</span>.</p>
<p>We will evaluate five scenarios to determine the effect of sample size re-estimation:</p>
<ul>
<li>Scenario 1: Null with <span class="math inline">\(p_1 = p_{trt} = 0.25\)</span> and <span class="math inline">\(p_2 = p_{con} = 0.25\)</span></li>
<li>Scenario 2: Null with <span class="math inline">\(p_1 = p_{trt} = 0.175\)</span> and <span class="math inline">\(p_2 = p_{con} = 0.175\)</span>, where the null rate is the nuisance parameter (i.e., <span class="math inline">\(\frac{0.1+0.25}{2}=0.175}\)</span>)</li>
<li>Scenario 3: Alternative with <span class="math inline">\(p_1 = 0.1\)</span> and <span class="math inline">\(p_2 = 0.25\)</span></li>
<li>Scenario 4: Alternative with <span class="math inline">\(p_1 = 0.15\)</span> and <span class="math inline">\(p_2 = 0.25\)</span></li>
<li>Scenario 5: Alternative with <span class="math inline">\(p_1 = 0.15\)</span> and <span class="math inline">\(p_2 = 0.30\)</span> (i.e., maintaining the <span class="math inline">\(\delta\)</span> but for different effects)</li>
</ul>
<section id="blinded-re-estimation-with-binary-outcome-simulation" class="level2">
<h2 class="anchored" data-anchor-id="blinded-re-estimation-with-binary-outcome-simulation">Blinded Re-estimation with Binary Outcome Simulation</h2>
<p>We first implement our blinded re-estimation procedure. We will compare three strategies:</p>
<ol type="1">
<li>Blinded SSR where we will allow for a smaller than planned sample size if indicated (i.e., if stage 2 needs fewer than 100 more participants, we will enroll that number)</li>
<li>Blinded SSR where we will continue with the planned sample size if the re-estimation indicates fewer participants could be needed (i.e., if stage 2 needs fewer than 100 more participants, we will still enroll 100)</li>
<li>A fixed sample design with no SSR</li>
</ol>
<p>The code is hidden, but can be shown if desired. We will summarize the rejection rate and average (SD) sample size across 1,000 simulation trials.</p>
<div class="cell" data-hash="index_cache/html/blindedSSR-binary-sim_687f0a565519545c21ef6f4b09331416">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>sim_list <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.175</span>,<span class="fl">0.175</span>), <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.3</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create objects to store results in</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>blinded_res <span class="ot">&lt;-</span> blinded_n2_res <span class="ot">&lt;-</span> fixed_res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">5</span>, <span class="at">ncol=</span><span class="dv">3</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">'Null 25 v 25'</span>,<span class="st">'Null 17.5 v 17.5'</span>,<span class="st">'Alt 10 v 25'</span>,<span class="st">'Alt 15 v 25'</span>,<span class="st">'Alt 15 v 30'</span>), <span class="fu">c</span>(<span class="st">'Rej_Rate'</span>,<span class="st">'ESS'</span>,<span class="st">'ESS_SD'</span>)))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set simulation parameters</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co"># total sample size based on fixed sample</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># sample size to enroll for stage 1</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fl">0.15</span> <span class="co"># expected effect size under H1 from power calculation</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># randomization ratio (e.g., 1:1)</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate method with SSR allowing for smaller than expected N</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  simres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">p=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop through nsim simulations</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># blinded re-estimation</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    p0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(trt,con) <span class="sc">/</span> n1</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assuming same delta, estimate new pt and pc</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    pt_n1 <span class="ot">&lt;-</span> p0 <span class="sc">-</span> delta<span class="sc">*</span>(r<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>r))</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    pc_n1 <span class="ot">&lt;-</span> p0 <span class="sc">+</span> delta<span class="sc">*</span>(r<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>r))</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use power.prop.test based on re-estimated pt (p1) and pc (p2)</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    n_rest <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span>pt_n1,<span class="at">p2=</span>pc_n1,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>,<span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> n_rest <span class="sc">-</span> n1 <span class="co"># estimate sample size needed for remainder</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( n2 <span class="sc">&lt;</span> <span class="dv">0</span> ){ n2 <span class="ot">&lt;-</span> <span class="dv">0</span> } <span class="co"># if sufficient sample size already, set to 0</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 2 data</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">c</span>(trt, <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt) )</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">c</span>(con, <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc) )</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># final analysis, save results</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(trt),<span class="fu">sum</span>(con)), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(trt),<span class="fu">length</span>(con)), <span class="at">alternative =</span> <span class="st">'less'</span>)    <span class="co"># defined as less based on order of data entered for trt and con</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    simres[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(res<span class="sc">$</span>p.value,<span class="dv">4</span>), n1<span class="sc">+</span>n2 )</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>  blinded_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.025</span>), <span class="fu">round</span>(<span class="fu">mean</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate method with SSR but enrolling at least (N-N1) in stage 2 (i.e., not allowing fewer participants)</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>  simres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">p=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop through nsim simulations</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># blinded re-estimation</span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>    p0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(trt,con) <span class="sc">/</span> n1</span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assuming same delta, estimate new pt and pc</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>    pt_n1 <span class="ot">&lt;-</span> p0 <span class="sc">-</span> delta<span class="sc">*</span>(r<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>r))</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>    pc_n1 <span class="ot">&lt;-</span> p0 <span class="sc">+</span> delta<span class="sc">*</span>(r<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>r))</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use power.prop.test based on re-estimated pt (p1) and pc (p2)</span></span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>    n_rest <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span>pt_n1,<span class="at">p2=</span>pc_n1,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>,<span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> n_rest <span class="sc">-</span> n1 <span class="co"># estimate sample size needed for remainder</span></span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( n2 <span class="sc">&lt;</span> (n<span class="sc">-</span>n1) ){ n2 <span class="ot">&lt;-</span> (n<span class="sc">-</span>n1) } <span class="co"># enroll at least (n-n1)</span></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 2 data</span></span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">c</span>(trt, <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt) )</span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">c</span>(con, <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc) )</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># final analysis, save results</span></span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(trt),<span class="fu">sum</span>(con)), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(trt),<span class="fu">length</span>(con)), <span class="at">alternative =</span> <span class="st">'less'</span>)    <span class="co"># defined as less based on order of data entered for trt and con</span></span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>    simres[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(res<span class="sc">$</span>p.value,<span class="dv">4</span>), n1<span class="sc">+</span>n2 )</span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>  blinded_n2_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.025</span>), <span class="fu">round</span>(<span class="fu">mean</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate fixed sample design for comparison</span></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a>  simres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">p=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop through nsim simulations</span></span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 2 after stage 1 to keep same random sequence</span></span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a>    trt2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>(n<span class="sc">-</span>n1)<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a>    con2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>(n<span class="sc">-</span>n1)<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># final analysis</span></span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">c</span>(trt,trt2)),<span class="fu">sum</span>(<span class="fu">c</span>(con,con2))), <span class="at">n=</span><span class="fu">c</span>(n<span class="sc">/</span><span class="dv">2</span>,n<span class="sc">/</span><span class="dv">2</span>), <span class="at">alternative =</span> <span class="st">'less'</span>)    <span class="co"># defined as less based on order of data entered for trt and con</span></span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a>    simres[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(res<span class="sc">$</span>p.value,<span class="dv">4</span>), n )</span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a>  fixed_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.025</span>), <span class="fu">round</span>(<span class="fu">mean</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Format results</span></span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a>kbl_tab <span class="ot">&lt;-</span> <span class="fu">cbind</span>(fixed_res,blinded_res,blinded_n2_res)</span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a>kbl_tab <span class="sc">%&gt;%</span></span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">col.names=</span><span class="fu">c</span>(<span class="st">'Scenario'</span>,<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'Rejection Rate'</span>,<span class="st">'ESS'</span>,<span class="st">'ESS SD'</span>), <span class="dv">3</span>)) ) <span class="sc">%&gt;%</span></span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">"Fixed Sample"</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">"SSR with Lower N2"</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">"SSR with At Least N2"</span><span class="ot">=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide;"></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
Fixed Sample
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
SSR with Lower N2
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
SSR with At Least N2
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">Scenario</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Rejection Rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS SD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Rejection Rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS SD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Rejection Rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS SD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Null 25 v 25</td>
<td style="text-align: right;">0.020</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.022</td>
<td style="text-align: right;">257.3</td>
<td style="text-align: right;">31.0</td>
<td style="text-align: right;">0.022</td>
<td style="text-align: right;">258.1</td>
<td style="text-align: right;">29.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Null 17.5 v 17.5</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.023</td>
<td style="text-align: right;">197.7</td>
<td style="text-align: right;">35.1</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">212.9</td>
<td style="text-align: right;">18.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alt 10 v 25</td>
<td style="text-align: right;">0.754</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.734</td>
<td style="text-align: right;">198.3</td>
<td style="text-align: right;">33.9</td>
<td style="text-align: right;">0.784</td>
<td style="text-align: right;">212.7</td>
<td style="text-align: right;">18.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alt 15 v 25</td>
<td style="text-align: right;">0.368</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.384</td>
<td style="text-align: right;">218.7</td>
<td style="text-align: right;">34.2</td>
<td style="text-align: right;">0.394</td>
<td style="text-align: right;">225.3</td>
<td style="text-align: right;">24.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alt 15 v 30</td>
<td style="text-align: right;">0.689</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.748</td>
<td style="text-align: right;">239.8</td>
<td style="text-align: right;">33.0</td>
<td style="text-align: right;">0.762</td>
<td style="text-align: right;">242.0</td>
<td style="text-align: right;">28.9</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>From these simulation results we can see that:</p>
<ul>
<li>Without some form of futility testing, the blinded SSR methods lead to increased sample sizes in the null scenario with 25% versus 25%, as well as slightly higher type I error rates than the fixed sample design.</li>
<li>If the null scenario response reflects the nuisance parameter, we still see slightly higher type I error rates with SSR. However, the ESS increase is less large, likely because the effect went closer to 0. This may indicate that less prevalent outcomes are less affected by the null scenario with blinded re-estimation.</li>
<li>If we encounter the effect sizes used in the power analysis, we see that SSR that enrolls <em>at least</em> the <span class="math inline">\(N_{total}=200\)</span> of the fixed sample design increases power by allowing for larger sample sizes. On average, across all 1000 simulated trials, the average sample size was 212.7 (SD=18.5).</li>
<li>If we encounter an underpowered scenario, we see that the SSR methods also lead to an increased SSR but only slightly higher power. This suggests that either unblinded re-estimation processes or potentially futility monitoring could further improve performance.</li>
<li>Finally, if we observe the same <span class="math inline">\(\delta=0.15\)</span> but at higher observed rates (<span class="math inline">\(p_{trt}=0.15\)</span> and <span class="math inline">\(p_{con}=0.30\)</span>), our blinded SSR increases power by 5.9 to 7.3% by allowing our sample size to increase based on the higher nuisance paramter (i.e., <span class="math inline">\(\frac{0.15+0.3}{2}=0.225\)</span>).</li>
</ul>
</section>
<section id="unblinded-re-estimation-with-binary-outcome-simulation" class="level2">
<h2 class="anchored" data-anchor-id="unblinded-re-estimation-with-binary-outcome-simulation">Unblinded Re-estimation with Binary Outcome Simulation</h2>
<p>We can compare the results from our blinded SSR approach with an approach using unblinded SSR approaches. In this simulation we compare:</p>
<ul>
<li>An approach using conditional power estimated from <code>gsDesign::ssrCP()</code>, where we assume that the second stage must have at least 100 participants but could increase to 200 participants (i.e., we don’t allow fewer than expected participants in stage 2). This approach uses the inverse normal combination test based on the p-values from the two-sample test of proportions.</li>
<li>An approach that unblinds the control arm to use in re-estimating the <code>power.prop.test()</code> calculation for a decrease of 15% in the treatment arm. If the control arm has a response rate less than 15%, we stop for futility and calculate the one-sided p-value to record for futility. Otherwise, we allow the re-estimation to increase the sample size from 100 up to 200. Since we do not unblind the treatment arm, in this approach we evaluate the performance if we use the overall data for our final test p-value.</li>
<li>A fixed sample design enrolling 200 total participants without interim monitoring or re-estimation.</li>
</ul>
<p>The simulation code block is hidden, but can be shown for review.</p>
<div class="cell" data-hash="index_cache/html/unblindedSSR-binary-sim_0917e9e7d4c8024a5d6cef3d09e21395">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gsDesign) <span class="co"># load library</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># list of 5 simulation scenarios to mimic our blinded SSR</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>sim_list <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.175</span>,<span class="fl">0.175</span>), <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.3</span>))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create objects to store results in</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>unblinded_res <span class="ot">&lt;-</span> unblinded_adhoc_res <span class="ot">&lt;-</span> fixed_res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">5</span>, <span class="at">ncol=</span><span class="dv">3</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">'Null 25 v 25'</span>,<span class="st">'Null 17.5 v 17.5'</span>,<span class="st">'Alt 10 v 25'</span>,<span class="st">'Alt 15 v 25'</span>,<span class="st">'Alt 15 v 30'</span>), <span class="fu">c</span>(<span class="st">'Rej_Rate'</span>,<span class="st">'ESS'</span>,<span class="st">'ESS_SD'</span>)))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set simulation parameters</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fl">0.15</span> <span class="co"># expected effect size under H1 from power calculation</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># randomization ratio (e.g., 1:1)</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">gsDesign</span>(</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">2</span>, </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.fix =</span> <span class="dv">200</span>, <span class="at">timing =</span> <span class="fl">0.5</span>, <span class="at">test.type=</span><span class="dv">2</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.025</span>, <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="at">delta0 =</span> <span class="dv">0</span>, <span class="at">delta1 =</span> <span class="fl">0.15</span>, <span class="at">sfu=</span><span class="st">'OF'</span> ) </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>n_fix <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co"># total sample size based on fixed sample</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(x<span class="sc">$</span>n.I[<span class="dv">1</span>])</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(x<span class="sc">$</span>n.I[<span class="dv">2</span>]) </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate method with SSR using conditional power</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  simres_gs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">zcombined=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    res_int <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(trt),<span class="fu">sum</span>(con)), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(trt),<span class="fu">length</span>(con)), <span class="at">alternative =</span> <span class="st">'less'</span>)<span class="sc">$</span>p.value</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># UNblinded re-estimation</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    xx <span class="ot">&lt;-</span> <span class="fu">ssrCP</span>(<span class="at">x =</span> x, <span class="at">z1 =</span> <span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>res_int), <span class="at">overrun =</span> <span class="dv">0</span>, <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="at">cpadj =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.8</span>), <span class="at">maxinc =</span> <span class="fl">1.5</span>, <span class="at">z2 =</span> z2NC)</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    n_rest <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(xx<span class="sc">$</span>dat<span class="sc">$</span>n2) <span class="sc">-</span> n1</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>      n2 <span class="ot">&lt;-</span> n_rest</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>      n2 <span class="ot">&lt;-</span> <span class="cf">if</span>(n2 <span class="sc">&lt;=</span> <span class="dv">100</span>){ <span class="dv">100</span> }<span class="cf">else</span>{n2} </span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( res_int <span class="sc">&lt;</span> x<span class="sc">$</span>upper<span class="sc">$</span>prob[<span class="dv">1</span>,<span class="dv">1</span>] ){ </span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># final analysis, save results</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>      zcombined <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>res_int) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span>)</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>      simres_gs[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(zcombined, n1<span class="sc">+</span><span class="dv">0</span>)</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>      <span class="co"># simulate stage 2 data</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>      trt2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>      con2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>      <span class="co"># final analysis, save results</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>      res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(trt2),<span class="fu">sum</span>(con2)), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(trt2),<span class="fu">length</span>(con2)), <span class="at">alternative =</span> <span class="st">'less'</span>)<span class="sc">$</span>p.value</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>      zcombined <span class="ot">&lt;-</span> ( <span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>res_int) <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>res) ) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>      simres_gs[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(zcombined, n1<span class="sc">+</span>n2)</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>  unblinded_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres_gs<span class="sc">$</span>zcombined <span class="sc">&gt;=</span> <span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>(<span class="fl">0.025</span>))), <span class="fu">round</span>(<span class="fu">mean</span>(simres_gs<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres_gs<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a><span class="co"># somewhat ad hoc approach to unblinded SSR</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="co"># first stage is used to implement re-estimation; no decreases in stage 2; up to 200 (versus 100) otherwise stop for futility</span></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set sample sizes based on fixed sample to initialize</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>  simres_gs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">p=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>    res_int <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(trt),<span class="fu">sum</span>(con)), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(trt),<span class="fu">length</span>(con)), <span class="at">alternative =</span> <span class="st">'less'</span>)</span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># UNblinded re-estimation, where we use the estimate of the control group and still power for a 0.15 decrease in treatment</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a>    n_reest <span class="ot">&lt;-</span> <span class="cf">if</span>( <span class="fu">mean</span>(con) <span class="sc">&lt;=</span> <span class="fl">0.15</span> ){ <span class="dv">10000</span> }<span class="cf">else</span>{ <span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fu">mean</span>(con)<span class="sc">-</span><span class="fl">0.15</span>,<span class="at">p2=</span><span class="fu">mean</span>(con),<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">2</span> }</span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> <span class="cf">if</span>( (n_reest <span class="sc">-</span> n1) <span class="sc">&lt;</span> <span class="dv">100</span> ){<span class="dv">100</span>}<span class="cf">else</span>{n_reest <span class="sc">-</span> n1}</span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>( n2 <span class="sc">&gt;</span> <span class="dv">200</span> ){</span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a>      <span class="co"># ad hoc futility rule, save first stage result</span></span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> res_int<span class="sc">$</span>p.value</span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>      simres_gs[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(p, n1<span class="sc">+</span><span class="dv">0</span>)</span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a>      <span class="co"># simulate stage 2 data</span></span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a>      trt2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>      con2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a>      <span class="co"># final analysis, save results</span></span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a>      res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">c</span>(trt,trt2)),<span class="fu">sum</span>(<span class="fu">c</span>(con,con2))), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(<span class="fu">c</span>(trt,trt2)),<span class="fu">length</span>(<span class="fu">c</span>(con,con2))), <span class="at">alternative =</span> <span class="st">'less'</span>)</span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> res<span class="sc">$</span>p.value</span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a>      simres_gs[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(p, n1<span class="sc">+</span>n2)</span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a>  unblinded_adhoc_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres_gs<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.025</span>), <span class="fu">round</span>(<span class="fu">mean</span>(simres_gs<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres_gs<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate fixed sample design for comparison</span></span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set sample sizes for fixed sample</span></span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a>  simres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">p=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop through nsim simulations</span></span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-138"><a href="#cb17-138" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb17-139"><a href="#cb17-139" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-142"><a href="#cb17-142" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 2 after stage 1 to keep same random sequence</span></span>
<span id="cb17-143"><a href="#cb17-143" aria-hidden="true" tabindex="-1"></a>    trt2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>(n<span class="sc">-</span>n1)<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb17-144"><a href="#cb17-144" aria-hidden="true" tabindex="-1"></a>    con2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>(n<span class="sc">-</span>n1)<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb17-145"><a href="#cb17-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-146"><a href="#cb17-146" aria-hidden="true" tabindex="-1"></a>    <span class="co"># final analysis</span></span>
<span id="cb17-147"><a href="#cb17-147" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">c</span>(trt,trt2)),<span class="fu">sum</span>(<span class="fu">c</span>(con,con2))), <span class="at">n=</span><span class="fu">c</span>(n<span class="sc">/</span><span class="dv">2</span>,n<span class="sc">/</span><span class="dv">2</span>), <span class="at">alternative =</span> <span class="st">'less'</span>)    <span class="co"># defined as less based on order of data entered for trt and con</span></span>
<span id="cb17-148"><a href="#cb17-148" aria-hidden="true" tabindex="-1"></a>    simres[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(res<span class="sc">$</span>p.value,<span class="dv">4</span>), n )</span>
<span id="cb17-149"><a href="#cb17-149" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-150"><a href="#cb17-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-151"><a href="#cb17-151" aria-hidden="true" tabindex="-1"></a>  fixed_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.025</span>), <span class="fu">round</span>(<span class="fu">mean</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb17-152"><a href="#cb17-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-153"><a href="#cb17-153" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb17-154"><a href="#cb17-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-155"><a href="#cb17-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Format results</span></span>
<span id="cb17-156"><a href="#cb17-156" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb17-157"><a href="#cb17-157" aria-hidden="true" tabindex="-1"></a>kbl_tab <span class="ot">&lt;-</span> <span class="fu">cbind</span>(fixed_res,unblinded_res,unblinded_adhoc_res)</span>
<span id="cb17-158"><a href="#cb17-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-159"><a href="#cb17-159" aria-hidden="true" tabindex="-1"></a>kbl_tab <span class="sc">%&gt;%</span></span>
<span id="cb17-160"><a href="#cb17-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">col.names=</span><span class="fu">c</span>(<span class="st">'Scenario'</span>,<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'Rejection Rate'</span>,<span class="st">'ESS'</span>,<span class="st">'ESS SD'</span>), <span class="dv">3</span>)) ) <span class="sc">%&gt;%</span></span>
<span id="cb17-161"><a href="#cb17-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-162"><a href="#cb17-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">"Fixed Sample"</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">"SSR with CP"</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">"SSR Unblind Control"</span><span class="ot">=</span><span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide;"></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
Fixed Sample
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
SSR with CP
</div></th>
<th colspan="3" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
SSR Unblind Control
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">Scenario</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Rejection Rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS SD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Rejection Rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS SD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Rejection Rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ESS SD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Null 25 v 25</td>
<td style="text-align: right;">0.020</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.010</td>
<td style="text-align: right;">203.9</td>
<td style="text-align: right;">11.7</td>
<td style="text-align: right;">0.022</td>
<td style="text-align: right;">212.6</td>
<td style="text-align: right;">39.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Null 17.5 v 17.5</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.015</td>
<td style="text-align: right;">203.7</td>
<td style="text-align: right;">13.4</td>
<td style="text-align: right;">0.022</td>
<td style="text-align: right;">170.3</td>
<td style="text-align: right;">49.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alt 10 v 25</td>
<td style="text-align: right;">0.754</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.716</td>
<td style="text-align: right;">198.7</td>
<td style="text-align: right;">46.0</td>
<td style="text-align: right;">0.740</td>
<td style="text-align: right;">212.6</td>
<td style="text-align: right;">39.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Alt 15 v 25</td>
<td style="text-align: right;">0.368</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.335</td>
<td style="text-align: right;">206.4</td>
<td style="text-align: right;">30.9</td>
<td style="text-align: right;">0.378</td>
<td style="text-align: right;">212.6</td>
<td style="text-align: right;">39.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alt 15 v 30</td>
<td style="text-align: right;">0.689</td>
<td style="text-align: right;">200</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.656</td>
<td style="text-align: right;">202.0</td>
<td style="text-align: right;">44.9</td>
<td style="text-align: right;">0.727</td>
<td style="text-align: right;">224.6</td>
<td style="text-align: right;">51.8</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The simulation results indicate:</p>
<ul>
<li>That the fixed sample design is slightly conservative with type I error of 2%, which is similar to the SSR with unblinded controls at 2.2%, although the sample size increases to an average of 212.6 (SD=39.0).</li>
<li>The SSR with conditional power is overly conservative, as seen by the lower type I error rates and power compared to the fixed sample design.</li>
<li>The SSR unblinded control shows the greatest improvement when the control reference is higher than expected (i.e., 30% instead of 25%), where power increases to 72.7% versus 68.9% for a fixed sample design. However, the ESS does increase to 224.6 (SD=51.8) versus 200 for the fixed sample design.</li>
<li>Some limitations in performance may be due to the fact that our allowed increase is somewhat limited in stage 2 from 100 to 200. In practice, if it was feasible to go higher we could likely improve our power relative to a fixed sample design.</li>
</ul>
<p>While only a limited set of methods and scenarios with a binary outcome, these results suggest the caution should be taken in implementing sample size re-estimation since it can introduce variability in our needed sample size while also potentially resulting in limited gains in power or type I error performance relative to a fixed sample design.</p>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>Below are some references to highlight based on the slides and code:</p>
<ul>
<li><p><a href="https://www.fda.gov/regulatory-information/search-fda-guidance-documents/adaptive-design-clinical-trials-drugs-and-biologics-guidance-industry">FDA Adaptive Design Clinical Trials for Drugs and Biologics Guidance for Industry Guidance Document</a>: FDA guidance document on adaptive trial elements</p></li>
<li><p><a href="https://www.cambridge.org/core/journals/journal-of-clinical-and-translational-science/article/recent-innovations-in-adaptive-trial-designs-a-review-of-design-opportunities-in-translational-research/614EAFEA5E89CA035E82E152AF660E5D?utm_campaign=shareaholic&amp;utm_medium=copy_link&amp;utm_source=bookmark">Recent innovations in adaptive trial designs: A review of design opportunities in translational research</a>: 2023 review paper examining adaptive and novel trial elements with included case studies</p></li>
<li><p><a href="https://www.cambridge.org/core/journals/journal-of-clinical-and-translational-science/article/guidance-on-interim-analysis-methods-in-clinical-trials/5051FDCF5284970B3DB01FE609AAA4C2?utm_campaign=shareaholic&amp;utm_medium=copy_link&amp;utm_source=bookmark">Guidance on interim analysis methods in clinical trials</a>: 2023 review paper focusing on interim analyses in clinical trials with included case studies</p></li>
<li><p><a href="https://link.springer.com/book/10.1007/978-3-030-49528-2">Kieser, Meinhard. <em>Methods and applications of sample size calculation and Recalculation in clinical trials.</em> Springer, 2020.</a>: textbook covering SSR methods and approaches</p></li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb18" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Sample Size Re-Estimation"</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="an">toc_float:</span><span class="co"> true</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="an">toc-location:</span><span class="co"> left</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap </span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo =</span> <span class="cn">TRUE</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="fu"># Overview</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>Oftentimes our power calculations represent our best guess at a realistic treatment effect, but even using previous studies or extensive clinical/scientific background can still result in uncertainty. In this module we discuss how we can incorporate re-estimation procedures during the trial to better ensure we enroll sufficient participants to detect the observed effect.</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="fu"># Slide Deck</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;iframe</span> <span class="er">class</span><span class="ot">=</span><span class="st">"speakerdeck-iframe"</span> <span class="er">style</span><span class="ot">=</span><span class="st">"border: 0px; background: rgba(0, 0, 0, 0.1) padding-box; margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 315;"</span> <span class="er">frameborder</span><span class="ot">=</span><span class="st">"0"</span> <span class="er">src</span><span class="ot">=</span><span class="st">"https://speakerdeck.com/player/4664c44f42e147b1bebe71608bda8c88"</span> <span class="er">title</span><span class="ot">=</span><span class="st">"Sample Size Re-Estimation"</span> <span class="er">allowfullscreen</span><span class="ot">=</span><span class="st">"true"</span> <span class="er">data-ratio</span><span class="ot">=</span><span class="st">"1.7777777777777777"</span><span class="kw">&gt;&lt;/iframe&gt;</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="dv">&amp;nbsp;</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>You can also download the <span class="co">[</span><span class="ot">original PowerPoint file</span><span class="co">](../files/Slides/4_sample_size_reestimation.pptx)</span>.</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># Code Examples in R</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>A selection of packages that may be helpful in implementing a re-estimation procedure include:</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">`blindrecalc`</span><span class="co">](https://cran.r-project.org/web/packages/blindrecalc/index.html)</span>: a package for *blinded* sample re-estimation based on estimating nuisance parameters</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">`rpact`</span><span class="co">](https://www.rpact.org/)</span>: a package for confirmatory adaptive clinical trial design, simulation, and analysis; includes functions for combination testing for use in unblinded designs</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">`gsDesign`</span><span class="co">](https://keaven.github.io/gsDesign/)</span>: includes the <span class="in">`ssrCP()`</span> function for unblinded re-estimation based on conditional power</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">`esDesign`</span><span class="co">](https://cran.r-project.org/web/packages/esDesign/)</span>: looks at adaptive enrichment designs with sample size re-estimation</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Blinded Example with Binary Outcome</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>In our first example we observe how the <span class="in">`blindrecalc`</span> package can be used for a study with a binary outcome. We will use a chi-squared test as our motivating example, largely following the steps from their helpful <span class="co">[</span><span class="ot">R Journal paper</span><span class="co">](https://journal.r-project.org/articles/RJ-2022-001/RJ-2022-001.pdf)</span>.</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>First we set up our design as the chi-squared test using <span class="in">`setupChiSquare()`</span>. In this example we are testing a one-sided hypothesis where $H_1\colon p_1 &gt; p_2$ with $\alpha=0.025$, $\beta=0.2$ (i.e., power of 80%), and we are interested in detecting a difference between two groups of 20% (i.e., $\delta=0.2$).</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>We can then estimate the number needed in a fixed sample design using <span class="in">`n_fix()`</span>. Here the nuisance parameter represents the average of the two groups. We can then estimate the $N$ needed overall with $N/2$ in each randomized group to detect a difference of 20%.</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(blindrecalc)</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare basic functions</span></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">setupChiSquare</span>(<span class="at">alpha =</span> <span class="fl">0.025</span>, <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="at">delta =</span> <span class="fl">0.2</span>, <span class="at">alternative =</span> <span class="st">"greater"</span>)</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a><span class="fu">n_fix</span>(design, <span class="at">nuisance =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>))</span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>We can verify these sample sizes are analogous to the <span class="in">`power.prop.test()`</span> function in base R:</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a><span class="do">### Check that power.prop.test matches n_fix (which it does)</span></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a><span class="do">## round up N for each group, multiple by 2 to match overall sample size from n_fix</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a><span class="co"># nuisance 0.2</span></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.1</span>,<span class="at">p2=</span><span class="fl">0.3</span>,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a><span class="co"># nuisance 0.3</span></span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>a2 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.2</span>,<span class="at">p2=</span><span class="fl">0.4</span>,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a><span class="co"># nuisance 0.4</span></span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>a3 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.3</span>,<span class="at">p2=</span><span class="fl">0.5</span>,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a><span class="co"># nuisance 0.5</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>a4 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.4</span>,<span class="at">p2=</span><span class="fl">0.6</span>,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a><span class="co"># print sample sizes</span></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(a1,a2,a3,a4)</span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>Let's focus on the <span class="in">`nusiance=0.2`</span> case. We can examine the impact on our design if we observe other nuisance parameters even though we anticipated 0.2. The <span class="in">`toer()`</span> function allows us to estimate the type I error rate we may encounter if we do or do not use blinded re-estimation:</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r toer-blindrecalc, cache=T}</span></span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">setupChiSquare</span>(<span class="at">alpha =</span> <span class="fl">0.025</span>, <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="at">delta =</span> <span class="fl">0.2</span>, <span class="at">alternative =</span> <span class="st">"greater"</span>)</span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">n_fix</span>(design, <span class="at">nuisance =</span> <span class="fl">0.2</span>) <span class="co"># N = 124 total (62 per group)</span></span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>toer_fix <span class="ot">&lt;-</span> <span class="fu">toer</span>(design, <span class="at">n1 =</span> n, <span class="at">nuisance =</span> p, <span class="at">recalculation =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>toer_ips <span class="ot">&lt;-</span> <span class="fu">toer</span>(design, <span class="at">n1 =</span> n<span class="sc">/</span><span class="dv">2</span>, <span class="at">nuisance =</span> p, <span class="at">recalculation =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>t1e_tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>( <span class="st">"No SSR"</span> <span class="ot">=</span> toer_fix, <span class="st">"SSR at 1/2 Enrolled"</span> <span class="ot">=</span> toer_ips)</span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(t1e_tab) <span class="ot">&lt;-</span> p</span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>t1e_tab</span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>By comparing these type I error rates, we see that there can be an inflation to our desired $\alpha=0.025$ due to observing different averages between our two groups (i.e., the nuisance parameters reflected by the column headers). With blinded SSR, we see better control of the type I error rate.</span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>We can use the similar <span class="in">`pow()`</span> to estimate the power under our design with varying nuisance parameters:</span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pow-blindrecalc, cache=T}</span></span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>pow_fix <span class="ot">&lt;-</span> <span class="fu">pow</span>(design, <span class="at">n1 =</span> n, <span class="at">nuisance =</span> p, <span class="at">recalculation =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>pow_ips <span class="ot">&lt;-</span> <span class="fu">pow</span>(design, <span class="at">n1 =</span> n<span class="sc">/</span><span class="dv">2</span>, <span class="at">nuisance =</span> p, <span class="at">recalculation =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a>pow_tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>( <span class="st">"No SSR"</span> <span class="ot">=</span> pow_fix, <span class="st">"SSR at 1/2 Enrolled"</span> <span class="ot">=</span> pow_ips)</span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pow_tab) <span class="ot">&lt;-</span> p</span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>pow_tab</span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>For power we see that SSR maintains approximately 80% power, but without SSR the power decreases as or nuisance parameter grows.</span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>We can also plot the distribution of sample sizes that would occur at different nuisance parameters to evaluate our potential risk of having a much larger sample size:</span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a><span class="fu">n_dist</span>(design, <span class="at">n1 =</span> n<span class="sc">/</span><span class="dv">2</span>, <span class="at">nuisance =</span> p, <span class="at">plot =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>In this figure above we see that if our nuisance parameter is actually 0.2 as assumed for the power calculation, or sample size re-estimation could range from 62 to 184 versus our planned $N=124$. However, this does assume we allow for sample size reductions and have no limit on the maximum increase. If our guess of the nuisance parameter is 0.5, we see the largest increase in our expected sample size up to 191.8, with a range of 154 to 194.</span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a><span class="fu">## Unblinded Conditional Power Example with Binary Outcome</span></span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a>The <span class="in">`gsDesign`</span> package includes the <span class="in">`ssrCP()`</span> which allows us to implement an *unblinded* sample size re-estimation procedure. Here we continue our previous example using a binary outcome. In this case we will incorporate traditional group sequential O'Brien-Fleming boundaries for interim monitoring for efficacy. This means our sample size will also be adjusted relative to a fixed design to account for the use of the traditional GSD (this is in contrast to alpha-spending boundaries that are OBF-like, where the sample size remains fixed).</span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a>First, we must establish the design type based on the <span class="in">`gsDesign()`</span> function before extending to a conditional power design with <span class="in">`ssrCP()`</span>:</span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gsDesign) <span class="co"># load package</span></span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">gsDesign</span>(</span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">2</span>, <span class="co"># number of analyses planned, including interim and final</span></span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.fix =</span> <span class="dv">196</span>, <span class="co"># sample size for a fixed design with no interim</span></span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a>  <span class="at">timing =</span> <span class="fl">0.5</span>, <span class="co"># timing of interm analyses </span></span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a>  <span class="at">test.type=</span><span class="dv">2</span>, <span class="co"># 6 options covering one- vs. two-sided and symmetric vs. asymmetric boundaries; 2 is a two-sided symmetric approach</span></span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.025</span>, <span class="co"># one-sided type I error rate</span></span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="co"># type II error rate (i.e., power=1-beta)</span></span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">delta0 =</span> <span class="dv">0</span>, <span class="co"># null hypothesis parameter (i.e., no difference)</span></span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">delta1 =</span> <span class="fl">0.2</span>, <span class="co"># alternative hypothesis parameter (i.e., difference we wish to detect)</span></span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">sfu=</span><span class="st">'OF'</span> ) <span class="co"># alpha-spending for efficacy monitoring</span></span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a><span class="co"># plot stopping boundaries</span></span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x)</span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a>The plot shows our stopping boundaries for our two-sided test, with the final critical value being 1.98 (versus 1.96 in a fixed design without interim monitoring), as well as an increase from $N=196$ to $N=198$.</span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a>We can then extend this design to a conditional power design based on an observed test statistic at the end of our first stage. Here we assume we observed $Z=1.6$:</span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a><span class="co"># extend design to a conditional power design</span></span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>xx <span class="ot">&lt;-</span> <span class="fu">ssrCP</span>(<span class="at">x =</span> x, <span class="co"># provide design used</span></span>
<span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a>            <span class="at">z1 =</span> <span class="fl">1.6</span>, <span class="co"># enter observed test statistic</span></span>
<span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a>            <span class="at">overrun =</span> <span class="dv">0</span>, <span class="co"># can note how many participants are enrolled but not included in the interim analysis</span></span>
<span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a>            <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="co"># targeted type II error for SSR (i.e., targeted power=1-beta)</span></span>
<span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a>            <span class="at">cpadj =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.8</span>), <span class="co"># range of conditional powers for which SSR is to be performed, otherwise N from original design used</span></span>
<span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a>            <span class="at">maxinc =</span> <span class="dv">2</span>, <span class="co"># argument limiting maximum fold-increase from planned max N (e.g., 2 times)</span></span>
<span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a>            <span class="at">z2 =</span> z2NC) <span class="co"># combination function to combine stage 1 and stage 2 results; z2NC=inverse normal combination test, z2Z=sufficient stat for complete data, z2Fisher=Fisher's combination test</span></span>
<span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a><span class="co"># show immediately relevant information</span></span>
<span id="cb18-168"><a href="#cb18-168" aria-hidden="true" tabindex="-1"></a>xx<span class="sc">$</span>dat</span>
<span id="cb18-169"><a href="#cb18-169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-170"><a href="#cb18-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-171"><a href="#cb18-171" aria-hidden="true" tabindex="-1"></a>From the <span class="in">`ssrCP`</span> documentation, we see these values represent:</span>
<span id="cb18-172"><a href="#cb18-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-173"><a href="#cb18-173" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>z1: input z1 values, </span>
<span id="cb18-174"><a href="#cb18-174" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>z2: computed cutoffs for the standard normal test statistic based solely on stage 2 data</span>
<span id="cb18-175"><a href="#cb18-175" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>n2: stage 2 sample size (however, based on other functions I believe this may be the maximum sample size to enroll, so we need to take n2-n1)</span>
<span id="cb18-176"><a href="#cb18-176" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>CP: stage 2 conditional power </span>
<span id="cb18-177"><a href="#cb18-177" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>theta: standardize effect size used for conditional power calculation </span>
<span id="cb18-178"><a href="#cb18-178" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>delta: the natural parameter value corresponding to theta The relation between theta and delta is determined by the delta0 and delta1 values from x: delta = delta0 + theta(delta1-delta0).</span>
<span id="cb18-179"><a href="#cb18-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-180"><a href="#cb18-180" aria-hidden="true" tabindex="-1"></a>The most important summary is the re-estimated sample size of $N=259.0207$ which rounds up to $N=260$, resulting in a need to enroll $N_2=260-99=161$ in stage 2 instead of the original $N_2 = 198-99=99$. Overall, this results in a total sample size of $N_1+N_2=99+161=260$, which is less than the two times inflation allowed by <span class="in">`maxinc=2`</span> (i.e., up to $198\times2 = 396$ is allowed).</span>
<span id="cb18-181"><a href="#cb18-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-182"><a href="#cb18-182" aria-hidden="true" tabindex="-1"></a>The other useful summary is the <span class="in">`z2=1.19651`</span>, which represents that we need to observe a test statistic at least this large for our inverse normal combination test to be significant.</span>
<span id="cb18-183"><a href="#cb18-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-184"><a href="#cb18-184" aria-hidden="true" tabindex="-1"></a>If we assume we enroll the 161 additional participants and observe $Z_2=1.3$, we would have a normal combination test of </span>
<span id="cb18-185"><a href="#cb18-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-186"><a href="#cb18-186" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span> \frac{Z_1 + Z_2}{\sqrt{2}} = \frac{1.6 +1.3}{\sqrt{2}} = 2.05 &gt; 1.96 = Z_{0.975} = Z_{1-\alpha/2} <span class="sc">\]</span></span>
<span id="cb18-187"><a href="#cb18-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-188"><a href="#cb18-188" aria-hidden="true" tabindex="-1"></a>Therefore, we would reject the null hypothesis and conclude we found an effect.</span>
<span id="cb18-189"><a href="#cb18-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-190"><a href="#cb18-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-191"><a href="#cb18-191" aria-hidden="true" tabindex="-1"></a><span class="fu"># Simulation Study</span></span>
<span id="cb18-192"><a href="#cb18-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-193"><a href="#cb18-193" aria-hidden="true" tabindex="-1"></a>For our simulation study, let's assume we are interested in designing a study where we wish to reduce the rate of an adverse event by exploring a new approach to a procedure:</span>
<span id="cb18-194"><a href="#cb18-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-195"><a href="#cb18-195" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$H_0\colon p_1 = p_2$ versus $H_1\colon p_1 &lt; p_2$ (i.e., one-sided hypothesis)</span>
<span id="cb18-196"><a href="#cb18-196" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$p_1 = p_{trt} = 0.1$ and $p_2 = p_{con} = 0.25$ for our alternative hypothesis of interest (i.e., reducing the rate of adverse events from 25% to 10%)</span>
<span id="cb18-197"><a href="#cb18-197" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\alpha=0.025$</span>
<span id="cb18-198"><a href="#cb18-198" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\beta=0.8$</span>
<span id="cb18-199"><a href="#cb18-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-200"><a href="#cb18-200" aria-hidden="true" tabindex="-1"></a>For a fixed sample design, using <span class="in">`power.prop.test()`</span>, we can identify our sample size to enroll:</span>
<span id="cb18-201"><a href="#cb18-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-204"><a href="#cb18-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb18-205"><a href="#cb18-205" aria-hidden="true" tabindex="-1"></a><span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fl">0.1</span>,<span class="at">p2=</span><span class="fl">0.25</span>,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)</span>
<span id="cb18-206"><a href="#cb18-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-207"><a href="#cb18-207" aria-hidden="true" tabindex="-1"></a>Given $n=100$ per arm, we would plan for a study enrolling a total of $N_{total}=200$.</span>
<span id="cb18-208"><a href="#cb18-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-209"><a href="#cb18-209" aria-hidden="true" tabindex="-1"></a>We will evaluate five scenarios to determine the effect of sample size re-estimation:</span>
<span id="cb18-210"><a href="#cb18-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-211"><a href="#cb18-211" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Scenario 1: Null with $p_1 = p_{trt} = 0.25$ and $p_2 = p_{con} = 0.25$</span>
<span id="cb18-212"><a href="#cb18-212" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Scenario 2: Null with $p_1 = p_{trt} = 0.175$ and $p_2 = p_{con} = 0.175$, where the null rate is the nuisance parameter (i.e., $\frac{0.1+0.25}{2}=0.175}$)</span>
<span id="cb18-213"><a href="#cb18-213" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Scenario 3: Alternative with $p_1 = 0.1$ and $p_2 = 0.25$</span>
<span id="cb18-214"><a href="#cb18-214" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Scenario 4: Alternative with $p_1 = 0.15$ and $p_2 = 0.25$</span>
<span id="cb18-215"><a href="#cb18-215" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Scenario 5: Alternative with $p_1 = 0.15$ and $p_2 = 0.30$ (i.e., maintaining the $\delta$ but for different effects)</span>
<span id="cb18-216"><a href="#cb18-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-217"><a href="#cb18-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-218"><a href="#cb18-218" aria-hidden="true" tabindex="-1"></a><span class="fu">## Blinded Re-estimation with Binary Outcome Simulation</span></span>
<span id="cb18-219"><a href="#cb18-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-220"><a href="#cb18-220" aria-hidden="true" tabindex="-1"></a>We first implement our blinded re-estimation procedure. We will compare three strategies:</span>
<span id="cb18-221"><a href="#cb18-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-222"><a href="#cb18-222" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Blinded SSR where we will allow for a smaller than planned sample size if indicated (i.e., if stage 2 needs fewer than 100 more participants, we will enroll that number)</span>
<span id="cb18-223"><a href="#cb18-223" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Blinded SSR where we will continue with the planned sample size if the re-estimation indicates fewer participants could be needed (i.e., if stage 2 needs fewer than 100 more participants, we will still enroll 100)</span>
<span id="cb18-224"><a href="#cb18-224" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>A fixed sample design with no SSR</span>
<span id="cb18-225"><a href="#cb18-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-226"><a href="#cb18-226" aria-hidden="true" tabindex="-1"></a>The code is hidden, but can be shown if desired. We will summarize the rejection rate and average (SD) sample size across 1,000 simulation trials.</span>
<span id="cb18-227"><a href="#cb18-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-228"><a href="#cb18-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r blindedSSR-binary-sim, cache=T, warning=F}</span></span>
<span id="cb18-229"><a href="#cb18-229" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb18-230"><a href="#cb18-230" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb18-231"><a href="#cb18-231" aria-hidden="true" tabindex="-1"></a>sim_list <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.175</span>,<span class="fl">0.175</span>), <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.3</span>))</span>
<span id="cb18-232"><a href="#cb18-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-233"><a href="#cb18-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Create objects to store results in</span></span>
<span id="cb18-234"><a href="#cb18-234" aria-hidden="true" tabindex="-1"></a>blinded_res <span class="ot">&lt;-</span> blinded_n2_res <span class="ot">&lt;-</span> fixed_res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">5</span>, <span class="at">ncol=</span><span class="dv">3</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">'Null 25 v 25'</span>,<span class="st">'Null 17.5 v 17.5'</span>,<span class="st">'Alt 10 v 25'</span>,<span class="st">'Alt 15 v 25'</span>,<span class="st">'Alt 15 v 30'</span>), <span class="fu">c</span>(<span class="st">'Rej_Rate'</span>,<span class="st">'ESS'</span>,<span class="st">'ESS_SD'</span>)))</span>
<span id="cb18-235"><a href="#cb18-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-236"><a href="#cb18-236" aria-hidden="true" tabindex="-1"></a><span class="co"># Set simulation parameters</span></span>
<span id="cb18-237"><a href="#cb18-237" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co"># total sample size based on fixed sample</span></span>
<span id="cb18-238"><a href="#cb18-238" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># sample size to enroll for stage 1</span></span>
<span id="cb18-239"><a href="#cb18-239" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fl">0.15</span> <span class="co"># expected effect size under H1 from power calculation</span></span>
<span id="cb18-240"><a href="#cb18-240" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># randomization ratio (e.g., 1:1)</span></span>
<span id="cb18-241"><a href="#cb18-241" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb18-242"><a href="#cb18-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-243"><a href="#cb18-243" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb18-244"><a href="#cb18-244" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate method with SSR allowing for smaller than expected N</span></span>
<span id="cb18-245"><a href="#cb18-245" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb18-246"><a href="#cb18-246" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-247"><a href="#cb18-247" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb18-248"><a href="#cb18-248" aria-hidden="true" tabindex="-1"></a>  simres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">p=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb18-249"><a href="#cb18-249" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-250"><a href="#cb18-250" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb18-251"><a href="#cb18-251" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb18-252"><a href="#cb18-252" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-253"><a href="#cb18-253" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop through nsim simulations</span></span>
<span id="cb18-254"><a href="#cb18-254" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb18-255"><a href="#cb18-255" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb18-256"><a href="#cb18-256" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-257"><a href="#cb18-257" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb18-258"><a href="#cb18-258" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb18-259"><a href="#cb18-259" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb18-260"><a href="#cb18-260" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-261"><a href="#cb18-261" aria-hidden="true" tabindex="-1"></a>    <span class="co"># blinded re-estimation</span></span>
<span id="cb18-262"><a href="#cb18-262" aria-hidden="true" tabindex="-1"></a>    p0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(trt,con) <span class="sc">/</span> n1</span>
<span id="cb18-263"><a href="#cb18-263" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-264"><a href="#cb18-264" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assuming same delta, estimate new pt and pc</span></span>
<span id="cb18-265"><a href="#cb18-265" aria-hidden="true" tabindex="-1"></a>    pt_n1 <span class="ot">&lt;-</span> p0 <span class="sc">-</span> delta<span class="sc">*</span>(r<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>r))</span>
<span id="cb18-266"><a href="#cb18-266" aria-hidden="true" tabindex="-1"></a>    pc_n1 <span class="ot">&lt;-</span> p0 <span class="sc">+</span> delta<span class="sc">*</span>(r<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>r))</span>
<span id="cb18-267"><a href="#cb18-267" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-268"><a href="#cb18-268" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use power.prop.test based on re-estimated pt (p1) and pc (p2)</span></span>
<span id="cb18-269"><a href="#cb18-269" aria-hidden="true" tabindex="-1"></a>    n_rest <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span>pt_n1,<span class="at">p2=</span>pc_n1,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>,<span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)</span>
<span id="cb18-270"><a href="#cb18-270" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> n_rest <span class="sc">-</span> n1 <span class="co"># estimate sample size needed for remainder</span></span>
<span id="cb18-271"><a href="#cb18-271" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( n2 <span class="sc">&lt;</span> <span class="dv">0</span> ){ n2 <span class="ot">&lt;-</span> <span class="dv">0</span> } <span class="co"># if sufficient sample size already, set to 0</span></span>
<span id="cb18-272"><a href="#cb18-272" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-273"><a href="#cb18-273" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 2 data</span></span>
<span id="cb18-274"><a href="#cb18-274" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">c</span>(trt, <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt) )</span>
<span id="cb18-275"><a href="#cb18-275" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">c</span>(con, <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc) )</span>
<span id="cb18-276"><a href="#cb18-276" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-277"><a href="#cb18-277" aria-hidden="true" tabindex="-1"></a>    <span class="co"># final analysis, save results</span></span>
<span id="cb18-278"><a href="#cb18-278" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(trt),<span class="fu">sum</span>(con)), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(trt),<span class="fu">length</span>(con)), <span class="at">alternative =</span> <span class="st">'less'</span>)    <span class="co"># defined as less based on order of data entered for trt and con</span></span>
<span id="cb18-279"><a href="#cb18-279" aria-hidden="true" tabindex="-1"></a>    simres[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(res<span class="sc">$</span>p.value,<span class="dv">4</span>), n1<span class="sc">+</span>n2 )</span>
<span id="cb18-280"><a href="#cb18-280" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-281"><a href="#cb18-281" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-282"><a href="#cb18-282" aria-hidden="true" tabindex="-1"></a>  blinded_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.025</span>), <span class="fu">round</span>(<span class="fu">mean</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb18-283"><a href="#cb18-283" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-284"><a href="#cb18-284" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-285"><a href="#cb18-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-286"><a href="#cb18-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-287"><a href="#cb18-287" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb18-288"><a href="#cb18-288" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate method with SSR but enrolling at least (N-N1) in stage 2 (i.e., not allowing fewer participants)</span></span>
<span id="cb18-289"><a href="#cb18-289" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb18-290"><a href="#cb18-290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-291"><a href="#cb18-291" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb18-292"><a href="#cb18-292" aria-hidden="true" tabindex="-1"></a>  simres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">p=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb18-293"><a href="#cb18-293" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-294"><a href="#cb18-294" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb18-295"><a href="#cb18-295" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb18-296"><a href="#cb18-296" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-297"><a href="#cb18-297" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop through nsim simulations</span></span>
<span id="cb18-298"><a href="#cb18-298" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb18-299"><a href="#cb18-299" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb18-300"><a href="#cb18-300" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-301"><a href="#cb18-301" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb18-302"><a href="#cb18-302" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb18-303"><a href="#cb18-303" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb18-304"><a href="#cb18-304" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-305"><a href="#cb18-305" aria-hidden="true" tabindex="-1"></a>    <span class="co"># blinded re-estimation</span></span>
<span id="cb18-306"><a href="#cb18-306" aria-hidden="true" tabindex="-1"></a>    p0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(trt,con) <span class="sc">/</span> n1</span>
<span id="cb18-307"><a href="#cb18-307" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-308"><a href="#cb18-308" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assuming same delta, estimate new pt and pc</span></span>
<span id="cb18-309"><a href="#cb18-309" aria-hidden="true" tabindex="-1"></a>    pt_n1 <span class="ot">&lt;-</span> p0 <span class="sc">-</span> delta<span class="sc">*</span>(r<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>r))</span>
<span id="cb18-310"><a href="#cb18-310" aria-hidden="true" tabindex="-1"></a>    pc_n1 <span class="ot">&lt;-</span> p0 <span class="sc">+</span> delta<span class="sc">*</span>(r<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>r))</span>
<span id="cb18-311"><a href="#cb18-311" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-312"><a href="#cb18-312" aria-hidden="true" tabindex="-1"></a>    <span class="co"># use power.prop.test based on re-estimated pt (p1) and pc (p2)</span></span>
<span id="cb18-313"><a href="#cb18-313" aria-hidden="true" tabindex="-1"></a>    n_rest <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span>pt_n1,<span class="at">p2=</span>pc_n1,<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>,<span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)</span>
<span id="cb18-314"><a href="#cb18-314" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> n_rest <span class="sc">-</span> n1 <span class="co"># estimate sample size needed for remainder</span></span>
<span id="cb18-315"><a href="#cb18-315" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( n2 <span class="sc">&lt;</span> (n<span class="sc">-</span>n1) ){ n2 <span class="ot">&lt;-</span> (n<span class="sc">-</span>n1) } <span class="co"># enroll at least (n-n1)</span></span>
<span id="cb18-316"><a href="#cb18-316" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-317"><a href="#cb18-317" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 2 data</span></span>
<span id="cb18-318"><a href="#cb18-318" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">c</span>(trt, <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt) )</span>
<span id="cb18-319"><a href="#cb18-319" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">c</span>(con, <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc) )</span>
<span id="cb18-320"><a href="#cb18-320" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-321"><a href="#cb18-321" aria-hidden="true" tabindex="-1"></a>    <span class="co"># final analysis, save results</span></span>
<span id="cb18-322"><a href="#cb18-322" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(trt),<span class="fu">sum</span>(con)), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(trt),<span class="fu">length</span>(con)), <span class="at">alternative =</span> <span class="st">'less'</span>)    <span class="co"># defined as less based on order of data entered for trt and con</span></span>
<span id="cb18-323"><a href="#cb18-323" aria-hidden="true" tabindex="-1"></a>    simres[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(res<span class="sc">$</span>p.value,<span class="dv">4</span>), n1<span class="sc">+</span>n2 )</span>
<span id="cb18-324"><a href="#cb18-324" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-325"><a href="#cb18-325" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-326"><a href="#cb18-326" aria-hidden="true" tabindex="-1"></a>  blinded_n2_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.025</span>), <span class="fu">round</span>(<span class="fu">mean</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb18-327"><a href="#cb18-327" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-328"><a href="#cb18-328" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-329"><a href="#cb18-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-330"><a href="#cb18-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-331"><a href="#cb18-331" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb18-332"><a href="#cb18-332" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate fixed sample design for comparison</span></span>
<span id="cb18-333"><a href="#cb18-333" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb18-334"><a href="#cb18-334" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-335"><a href="#cb18-335" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb18-336"><a href="#cb18-336" aria-hidden="true" tabindex="-1"></a>  simres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">p=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb18-337"><a href="#cb18-337" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-338"><a href="#cb18-338" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb18-339"><a href="#cb18-339" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb18-340"><a href="#cb18-340" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-341"><a href="#cb18-341" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop through nsim simulations</span></span>
<span id="cb18-342"><a href="#cb18-342" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb18-343"><a href="#cb18-343" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb18-344"><a href="#cb18-344" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-345"><a href="#cb18-345" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb18-346"><a href="#cb18-346" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb18-347"><a href="#cb18-347" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb18-348"><a href="#cb18-348" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-349"><a href="#cb18-349" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 2 after stage 1 to keep same random sequence</span></span>
<span id="cb18-350"><a href="#cb18-350" aria-hidden="true" tabindex="-1"></a>    trt2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>(n<span class="sc">-</span>n1)<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb18-351"><a href="#cb18-351" aria-hidden="true" tabindex="-1"></a>    con2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>(n<span class="sc">-</span>n1)<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb18-352"><a href="#cb18-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-353"><a href="#cb18-353" aria-hidden="true" tabindex="-1"></a>    <span class="co"># final analysis</span></span>
<span id="cb18-354"><a href="#cb18-354" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">c</span>(trt,trt2)),<span class="fu">sum</span>(<span class="fu">c</span>(con,con2))), <span class="at">n=</span><span class="fu">c</span>(n<span class="sc">/</span><span class="dv">2</span>,n<span class="sc">/</span><span class="dv">2</span>), <span class="at">alternative =</span> <span class="st">'less'</span>)    <span class="co"># defined as less based on order of data entered for trt and con</span></span>
<span id="cb18-355"><a href="#cb18-355" aria-hidden="true" tabindex="-1"></a>    simres[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(res<span class="sc">$</span>p.value,<span class="dv">4</span>), n )</span>
<span id="cb18-356"><a href="#cb18-356" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-357"><a href="#cb18-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-358"><a href="#cb18-358" aria-hidden="true" tabindex="-1"></a>  fixed_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.025</span>), <span class="fu">round</span>(<span class="fu">mean</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb18-359"><a href="#cb18-359" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-360"><a href="#cb18-360" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb18-361"><a href="#cb18-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-362"><a href="#cb18-362" aria-hidden="true" tabindex="-1"></a><span class="co"># Format results</span></span>
<span id="cb18-363"><a href="#cb18-363" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb18-364"><a href="#cb18-364" aria-hidden="true" tabindex="-1"></a>kbl_tab <span class="ot">&lt;-</span> <span class="fu">cbind</span>(fixed_res,blinded_res,blinded_n2_res)</span>
<span id="cb18-365"><a href="#cb18-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-366"><a href="#cb18-366" aria-hidden="true" tabindex="-1"></a>kbl_tab <span class="sc">%&gt;%</span></span>
<span id="cb18-367"><a href="#cb18-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">col.names=</span><span class="fu">c</span>(<span class="st">'Scenario'</span>,<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'Rejection Rate'</span>,<span class="st">'ESS'</span>,<span class="st">'ESS SD'</span>), <span class="dv">3</span>)) ) <span class="sc">%&gt;%</span></span>
<span id="cb18-368"><a href="#cb18-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-369"><a href="#cb18-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">"Fixed Sample"</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">"SSR with Lower N2"</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">"SSR with At Least N2"</span><span class="ot">=</span><span class="dv">3</span>))</span>
<span id="cb18-370"><a href="#cb18-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-371"><a href="#cb18-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-372"><a href="#cb18-372" aria-hidden="true" tabindex="-1"></a>From these simulation results we can see that:</span>
<span id="cb18-373"><a href="#cb18-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-374"><a href="#cb18-374" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Without some form of futility testing, the blinded SSR methods lead to increased sample sizes in the null scenario with 25% versus 25%, as well as slightly higher type I error rates than the fixed sample design.</span>
<span id="cb18-375"><a href="#cb18-375" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>If the null scenario response reflects the nuisance parameter, we still see slightly higher type I error rates with SSR. However, the ESS increase is less large, likely because the effect went closer to 0. This may indicate that less prevalent outcomes are less affected by the null scenario with blinded re-estimation.</span>
<span id="cb18-376"><a href="#cb18-376" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>If we encounter the effect sizes used in the power analysis, we see that SSR that enrolls *at least* the $N_{total}=200$ of the fixed sample design increases power by allowing for larger sample sizes. On average, across all 1000 simulated trials, the average sample size was 212.7 (SD=18.5).</span>
<span id="cb18-377"><a href="#cb18-377" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>If we encounter an underpowered scenario, we see that the SSR methods also lead to an increased SSR but only slightly higher power. This suggests that either unblinded re-estimation processes or potentially futility monitoring could further improve performance.</span>
<span id="cb18-378"><a href="#cb18-378" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Finally, if we observe the same $\delta=0.15$ but at higher observed rates ($p_{trt}=0.15$ and $p_{con}=0.30$), our blinded SSR increases power by 5.9 to 7.3% by allowing our sample size to increase based on the higher nuisance paramter (i.e., $\frac{0.15+0.3}{2}=0.225$).</span>
<span id="cb18-379"><a href="#cb18-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-380"><a href="#cb18-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-381"><a href="#cb18-381" aria-hidden="true" tabindex="-1"></a><span class="fu">## Unblinded Re-estimation with Binary Outcome Simulation</span></span>
<span id="cb18-382"><a href="#cb18-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-383"><a href="#cb18-383" aria-hidden="true" tabindex="-1"></a>We can compare the results from our blinded SSR approach with an approach using unblinded SSR approaches. In this simulation we compare:</span>
<span id="cb18-384"><a href="#cb18-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-385"><a href="#cb18-385" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>An approach using conditional power estimated from <span class="in">`gsDesign::ssrCP()`</span>, where we assume that the second stage must have at least 100 participants but could increase to 200 participants (i.e., we don't allow fewer than expected participants in stage 2). This approach uses the inverse normal combination test based on the p-values from the two-sample test of proportions.</span>
<span id="cb18-386"><a href="#cb18-386" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>An approach that unblinds the control arm to use in re-estimating the <span class="in">`power.prop.test()`</span> calculation for a decrease of 15% in the treatment arm. If the control arm has a response rate less than 15%, we stop for futility and calculate the one-sided p-value to record for futility. Otherwise, we allow the re-estimation to increase the sample size from 100 up to 200. Since we do not unblind the treatment arm, in this approach we evaluate the performance if we use the overall data for our final test p-value.</span>
<span id="cb18-387"><a href="#cb18-387" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>A fixed sample design enrolling 200 total participants without interim monitoring or re-estimation.</span>
<span id="cb18-388"><a href="#cb18-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-389"><a href="#cb18-389" aria-hidden="true" tabindex="-1"></a>The simulation code block is hidden, but can be shown for review.</span>
<span id="cb18-390"><a href="#cb18-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-391"><a href="#cb18-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r unblindedSSR-binary-sim, cache=T, warning=F}</span></span>
<span id="cb18-392"><a href="#cb18-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb18-393"><a href="#cb18-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb18-394"><a href="#cb18-394" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gsDesign) <span class="co"># load library</span></span>
<span id="cb18-395"><a href="#cb18-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-396"><a href="#cb18-396" aria-hidden="true" tabindex="-1"></a><span class="co"># list of 5 simulation scenarios to mimic our blinded SSR</span></span>
<span id="cb18-397"><a href="#cb18-397" aria-hidden="true" tabindex="-1"></a>sim_list <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.175</span>,<span class="fl">0.175</span>), <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.25</span>), <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.3</span>))</span>
<span id="cb18-398"><a href="#cb18-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-399"><a href="#cb18-399" aria-hidden="true" tabindex="-1"></a><span class="co"># Create objects to store results in</span></span>
<span id="cb18-400"><a href="#cb18-400" aria-hidden="true" tabindex="-1"></a>unblinded_res <span class="ot">&lt;-</span> unblinded_adhoc_res <span class="ot">&lt;-</span> fixed_res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">5</span>, <span class="at">ncol=</span><span class="dv">3</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">'Null 25 v 25'</span>,<span class="st">'Null 17.5 v 17.5'</span>,<span class="st">'Alt 10 v 25'</span>,<span class="st">'Alt 15 v 25'</span>,<span class="st">'Alt 15 v 30'</span>), <span class="fu">c</span>(<span class="st">'Rej_Rate'</span>,<span class="st">'ESS'</span>,<span class="st">'ESS_SD'</span>)))</span>
<span id="cb18-401"><a href="#cb18-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-402"><a href="#cb18-402" aria-hidden="true" tabindex="-1"></a><span class="co"># Set simulation parameters</span></span>
<span id="cb18-403"><a href="#cb18-403" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fl">0.15</span> <span class="co"># expected effect size under H1 from power calculation</span></span>
<span id="cb18-404"><a href="#cb18-404" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># randomization ratio (e.g., 1:1)</span></span>
<span id="cb18-405"><a href="#cb18-405" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb18-406"><a href="#cb18-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-407"><a href="#cb18-407" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">gsDesign</span>(</span>
<span id="cb18-408"><a href="#cb18-408" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">2</span>, </span>
<span id="cb18-409"><a href="#cb18-409" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.fix =</span> <span class="dv">200</span>, <span class="at">timing =</span> <span class="fl">0.5</span>, <span class="at">test.type=</span><span class="dv">2</span>,</span>
<span id="cb18-410"><a href="#cb18-410" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.025</span>, <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="at">delta0 =</span> <span class="dv">0</span>, <span class="at">delta1 =</span> <span class="fl">0.15</span>, <span class="at">sfu=</span><span class="st">'OF'</span> ) </span>
<span id="cb18-411"><a href="#cb18-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-412"><a href="#cb18-412" aria-hidden="true" tabindex="-1"></a>n_fix <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co"># total sample size based on fixed sample</span></span>
<span id="cb18-413"><a href="#cb18-413" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(x<span class="sc">$</span>n.I[<span class="dv">1</span>])</span>
<span id="cb18-414"><a href="#cb18-414" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(x<span class="sc">$</span>n.I[<span class="dv">2</span>]) </span>
<span id="cb18-415"><a href="#cb18-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-416"><a href="#cb18-416" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb18-417"><a href="#cb18-417" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate method with SSR using conditional power</span></span>
<span id="cb18-418"><a href="#cb18-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-419"><a href="#cb18-419" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb18-420"><a href="#cb18-420" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-421"><a href="#cb18-421" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb18-422"><a href="#cb18-422" aria-hidden="true" tabindex="-1"></a>  simres_gs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">zcombined=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb18-423"><a href="#cb18-423" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-424"><a href="#cb18-424" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb18-425"><a href="#cb18-425" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb18-426"><a href="#cb18-426" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-427"><a href="#cb18-427" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb18-428"><a href="#cb18-428" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb18-429"><a href="#cb18-429" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-430"><a href="#cb18-430" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb18-431"><a href="#cb18-431" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb18-432"><a href="#cb18-432" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb18-433"><a href="#cb18-433" aria-hidden="true" tabindex="-1"></a>    res_int <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(trt),<span class="fu">sum</span>(con)), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(trt),<span class="fu">length</span>(con)), <span class="at">alternative =</span> <span class="st">'less'</span>)<span class="sc">$</span>p.value</span>
<span id="cb18-434"><a href="#cb18-434" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-435"><a href="#cb18-435" aria-hidden="true" tabindex="-1"></a>    <span class="co"># UNblinded re-estimation</span></span>
<span id="cb18-436"><a href="#cb18-436" aria-hidden="true" tabindex="-1"></a>    xx <span class="ot">&lt;-</span> <span class="fu">ssrCP</span>(<span class="at">x =</span> x, <span class="at">z1 =</span> <span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>res_int), <span class="at">overrun =</span> <span class="dv">0</span>, <span class="at">beta =</span> <span class="fl">0.2</span>, <span class="at">cpadj =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.8</span>), <span class="at">maxinc =</span> <span class="fl">1.5</span>, <span class="at">z2 =</span> z2NC)</span>
<span id="cb18-437"><a href="#cb18-437" aria-hidden="true" tabindex="-1"></a>    n_rest <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(xx<span class="sc">$</span>dat<span class="sc">$</span>n2) <span class="sc">-</span> n1</span>
<span id="cb18-438"><a href="#cb18-438" aria-hidden="true" tabindex="-1"></a>      n2 <span class="ot">&lt;-</span> n_rest</span>
<span id="cb18-439"><a href="#cb18-439" aria-hidden="true" tabindex="-1"></a>      n2 <span class="ot">&lt;-</span> <span class="cf">if</span>(n2 <span class="sc">&lt;=</span> <span class="dv">100</span>){ <span class="dv">100</span> }<span class="cf">else</span>{n2} </span>
<span id="cb18-440"><a href="#cb18-440" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( res_int <span class="sc">&lt;</span> x<span class="sc">$</span>upper<span class="sc">$</span>prob[<span class="dv">1</span>,<span class="dv">1</span>] ){ </span>
<span id="cb18-441"><a href="#cb18-441" aria-hidden="true" tabindex="-1"></a>      <span class="co"># final analysis, save results</span></span>
<span id="cb18-442"><a href="#cb18-442" aria-hidden="true" tabindex="-1"></a>      zcombined <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>res_int) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">1</span>)</span>
<span id="cb18-443"><a href="#cb18-443" aria-hidden="true" tabindex="-1"></a>      simres_gs[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(zcombined, n1<span class="sc">+</span><span class="dv">0</span>)</span>
<span id="cb18-444"><a href="#cb18-444" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb18-445"><a href="#cb18-445" aria-hidden="true" tabindex="-1"></a>      <span class="co"># simulate stage 2 data</span></span>
<span id="cb18-446"><a href="#cb18-446" aria-hidden="true" tabindex="-1"></a>      trt2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb18-447"><a href="#cb18-447" aria-hidden="true" tabindex="-1"></a>      con2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb18-448"><a href="#cb18-448" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-449"><a href="#cb18-449" aria-hidden="true" tabindex="-1"></a>      <span class="co"># final analysis, save results</span></span>
<span id="cb18-450"><a href="#cb18-450" aria-hidden="true" tabindex="-1"></a>      res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(trt2),<span class="fu">sum</span>(con2)), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(trt2),<span class="fu">length</span>(con2)), <span class="at">alternative =</span> <span class="st">'less'</span>)<span class="sc">$</span>p.value</span>
<span id="cb18-451"><a href="#cb18-451" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-452"><a href="#cb18-452" aria-hidden="true" tabindex="-1"></a>      zcombined <span class="ot">&lt;-</span> ( <span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>res_int) <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>res) ) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb18-453"><a href="#cb18-453" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-454"><a href="#cb18-454" aria-hidden="true" tabindex="-1"></a>      simres_gs[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(zcombined, n1<span class="sc">+</span>n2)</span>
<span id="cb18-455"><a href="#cb18-455" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-456"><a href="#cb18-456" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-457"><a href="#cb18-457" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-458"><a href="#cb18-458" aria-hidden="true" tabindex="-1"></a>  unblinded_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres_gs<span class="sc">$</span>zcombined <span class="sc">&gt;=</span> <span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>(<span class="fl">0.025</span>))), <span class="fu">round</span>(<span class="fu">mean</span>(simres_gs<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres_gs<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb18-459"><a href="#cb18-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-460"><a href="#cb18-460" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-461"><a href="#cb18-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-462"><a href="#cb18-462" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb18-463"><a href="#cb18-463" aria-hidden="true" tabindex="-1"></a><span class="co"># somewhat ad hoc approach to unblinded SSR</span></span>
<span id="cb18-464"><a href="#cb18-464" aria-hidden="true" tabindex="-1"></a><span class="co"># first stage is used to implement re-estimation; no decreases in stage 2; up to 200 (versus 100) otherwise stop for futility</span></span>
<span id="cb18-465"><a href="#cb18-465" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb18-466"><a href="#cb18-466" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-467"><a href="#cb18-467" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set sample sizes based on fixed sample to initialize</span></span>
<span id="cb18-468"><a href="#cb18-468" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb18-469"><a href="#cb18-469" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb18-470"><a href="#cb18-470" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-471"><a href="#cb18-471" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb18-472"><a href="#cb18-472" aria-hidden="true" tabindex="-1"></a>  simres_gs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">p=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb18-473"><a href="#cb18-473" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-474"><a href="#cb18-474" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb18-475"><a href="#cb18-475" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb18-476"><a href="#cb18-476" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-477"><a href="#cb18-477" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb18-478"><a href="#cb18-478" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb18-479"><a href="#cb18-479" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-480"><a href="#cb18-480" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb18-481"><a href="#cb18-481" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb18-482"><a href="#cb18-482" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb18-483"><a href="#cb18-483" aria-hidden="true" tabindex="-1"></a>    res_int <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(trt),<span class="fu">sum</span>(con)), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(trt),<span class="fu">length</span>(con)), <span class="at">alternative =</span> <span class="st">'less'</span>)</span>
<span id="cb18-484"><a href="#cb18-484" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-485"><a href="#cb18-485" aria-hidden="true" tabindex="-1"></a>    <span class="co"># UNblinded re-estimation, where we use the estimate of the control group and still power for a 0.15 decrease in treatment</span></span>
<span id="cb18-486"><a href="#cb18-486" aria-hidden="true" tabindex="-1"></a>    n_reest <span class="ot">&lt;-</span> <span class="cf">if</span>( <span class="fu">mean</span>(con) <span class="sc">&lt;=</span> <span class="fl">0.15</span> ){ <span class="dv">10000</span> }<span class="cf">else</span>{ <span class="fu">ceiling</span>(<span class="fu">power.prop.test</span>(<span class="at">p1=</span><span class="fu">mean</span>(con)<span class="sc">-</span><span class="fl">0.15</span>,<span class="at">p2=</span><span class="fu">mean</span>(con),<span class="at">sig.level=</span><span class="fl">0.025</span>,<span class="at">power=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">'o'</span>)<span class="sc">$</span>n)<span class="sc">*</span><span class="dv">2</span> }</span>
<span id="cb18-487"><a href="#cb18-487" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-488"><a href="#cb18-488" aria-hidden="true" tabindex="-1"></a>    n2 <span class="ot">&lt;-</span> <span class="cf">if</span>( (n_reest <span class="sc">-</span> n1) <span class="sc">&lt;</span> <span class="dv">100</span> ){<span class="dv">100</span>}<span class="cf">else</span>{n_reest <span class="sc">-</span> n1}</span>
<span id="cb18-489"><a href="#cb18-489" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-490"><a href="#cb18-490" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>( n2 <span class="sc">&gt;</span> <span class="dv">200</span> ){</span>
<span id="cb18-491"><a href="#cb18-491" aria-hidden="true" tabindex="-1"></a>      <span class="co"># ad hoc futility rule, save first stage result</span></span>
<span id="cb18-492"><a href="#cb18-492" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> res_int<span class="sc">$</span>p.value</span>
<span id="cb18-493"><a href="#cb18-493" aria-hidden="true" tabindex="-1"></a>      simres_gs[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(p, n1<span class="sc">+</span><span class="dv">0</span>)</span>
<span id="cb18-494"><a href="#cb18-494" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb18-495"><a href="#cb18-495" aria-hidden="true" tabindex="-1"></a>      <span class="co"># simulate stage 2 data</span></span>
<span id="cb18-496"><a href="#cb18-496" aria-hidden="true" tabindex="-1"></a>      trt2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb18-497"><a href="#cb18-497" aria-hidden="true" tabindex="-1"></a>      con2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n2<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb18-498"><a href="#cb18-498" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb18-499"><a href="#cb18-499" aria-hidden="true" tabindex="-1"></a>      <span class="co"># final analysis, save results</span></span>
<span id="cb18-500"><a href="#cb18-500" aria-hidden="true" tabindex="-1"></a>      res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">c</span>(trt,trt2)),<span class="fu">sum</span>(<span class="fu">c</span>(con,con2))), <span class="at">n=</span><span class="fu">c</span>(<span class="fu">length</span>(<span class="fu">c</span>(trt,trt2)),<span class="fu">length</span>(<span class="fu">c</span>(con,con2))), <span class="at">alternative =</span> <span class="st">'less'</span>)</span>
<span id="cb18-501"><a href="#cb18-501" aria-hidden="true" tabindex="-1"></a>      p <span class="ot">&lt;-</span> res<span class="sc">$</span>p.value</span>
<span id="cb18-502"><a href="#cb18-502" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-503"><a href="#cb18-503" aria-hidden="true" tabindex="-1"></a>      simres_gs[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(p, n1<span class="sc">+</span>n2)</span>
<span id="cb18-504"><a href="#cb18-504" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-505"><a href="#cb18-505" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-506"><a href="#cb18-506" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-507"><a href="#cb18-507" aria-hidden="true" tabindex="-1"></a>  unblinded_adhoc_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres_gs<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.025</span>), <span class="fu">round</span>(<span class="fu">mean</span>(simres_gs<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres_gs<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb18-508"><a href="#cb18-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-509"><a href="#cb18-509" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-510"><a href="#cb18-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-511"><a href="#cb18-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-512"><a href="#cb18-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-513"><a href="#cb18-513" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb18-514"><a href="#cb18-514" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate fixed sample design for comparison</span></span>
<span id="cb18-515"><a href="#cb18-515" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( combo <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim_list) ){</span>
<span id="cb18-516"><a href="#cb18-516" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-517"><a href="#cb18-517" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set sample sizes for fixed sample</span></span>
<span id="cb18-518"><a href="#cb18-518" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb18-519"><a href="#cb18-519" aria-hidden="true" tabindex="-1"></a>  n1 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb18-520"><a href="#cb18-520" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-521"><a href="#cb18-521" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize object to save results in</span></span>
<span id="cb18-522"><a href="#cb18-522" aria-hidden="true" tabindex="-1"></a>  simres <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">p=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim), <span class="at">n=</span><span class="fu">rep</span>(<span class="cn">NA</span>,nsim) )</span>
<span id="cb18-523"><a href="#cb18-523" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-524"><a href="#cb18-524" aria-hidden="true" tabindex="-1"></a>  pt <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">1</span>]</span>
<span id="cb18-525"><a href="#cb18-525" aria-hidden="true" tabindex="-1"></a>  pc <span class="ot">&lt;-</span> sim_list[[combo]][<span class="dv">2</span>]</span>
<span id="cb18-526"><a href="#cb18-526" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-527"><a href="#cb18-527" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop through nsim simulations</span></span>
<span id="cb18-528"><a href="#cb18-528" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsim ){</span>
<span id="cb18-529"><a href="#cb18-529" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(i) <span class="co"># set seed for reproducibility</span></span>
<span id="cb18-530"><a href="#cb18-530" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-531"><a href="#cb18-531" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 1</span></span>
<span id="cb18-532"><a href="#cb18-532" aria-hidden="true" tabindex="-1"></a>    trt <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb18-533"><a href="#cb18-533" aria-hidden="true" tabindex="-1"></a>    con <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>n1<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb18-534"><a href="#cb18-534" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-535"><a href="#cb18-535" aria-hidden="true" tabindex="-1"></a>    <span class="co"># simulate stage 2 after stage 1 to keep same random sequence</span></span>
<span id="cb18-536"><a href="#cb18-536" aria-hidden="true" tabindex="-1"></a>    trt2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>(n<span class="sc">-</span>n1)<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pt)</span>
<span id="cb18-537"><a href="#cb18-537" aria-hidden="true" tabindex="-1"></a>    con2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span>(n<span class="sc">-</span>n1)<span class="sc">/</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span>pc)</span>
<span id="cb18-538"><a href="#cb18-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-539"><a href="#cb18-539" aria-hidden="true" tabindex="-1"></a>    <span class="co"># final analysis</span></span>
<span id="cb18-540"><a href="#cb18-540" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">prop.test</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="fu">sum</span>(<span class="fu">c</span>(trt,trt2)),<span class="fu">sum</span>(<span class="fu">c</span>(con,con2))), <span class="at">n=</span><span class="fu">c</span>(n<span class="sc">/</span><span class="dv">2</span>,n<span class="sc">/</span><span class="dv">2</span>), <span class="at">alternative =</span> <span class="st">'less'</span>)    <span class="co"># defined as less based on order of data entered for trt and con</span></span>
<span id="cb18-541"><a href="#cb18-541" aria-hidden="true" tabindex="-1"></a>    simres[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">round</span>(res<span class="sc">$</span>p.value,<span class="dv">4</span>), n )</span>
<span id="cb18-542"><a href="#cb18-542" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-543"><a href="#cb18-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-544"><a href="#cb18-544" aria-hidden="true" tabindex="-1"></a>  fixed_res[combo,] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">mean</span>(simres<span class="sc">$</span>p <span class="sc">&lt;</span> <span class="fl">0.025</span>), <span class="fu">round</span>(<span class="fu">mean</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>), <span class="fu">round</span>(<span class="fu">sd</span>(simres<span class="sc">$</span>n),<span class="dv">1</span>))</span>
<span id="cb18-545"><a href="#cb18-545" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-546"><a href="#cb18-546" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb18-547"><a href="#cb18-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-548"><a href="#cb18-548" aria-hidden="true" tabindex="-1"></a><span class="co"># Format results</span></span>
<span id="cb18-549"><a href="#cb18-549" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb18-550"><a href="#cb18-550" aria-hidden="true" tabindex="-1"></a>kbl_tab <span class="ot">&lt;-</span> <span class="fu">cbind</span>(fixed_res,unblinded_res,unblinded_adhoc_res)</span>
<span id="cb18-551"><a href="#cb18-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-552"><a href="#cb18-552" aria-hidden="true" tabindex="-1"></a>kbl_tab <span class="sc">%&gt;%</span></span>
<span id="cb18-553"><a href="#cb18-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">col.names=</span><span class="fu">c</span>(<span class="st">'Scenario'</span>,<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'Rejection Rate'</span>,<span class="st">'ESS'</span>,<span class="st">'ESS SD'</span>), <span class="dv">3</span>)) ) <span class="sc">%&gt;%</span></span>
<span id="cb18-554"><a href="#cb18-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-555"><a href="#cb18-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span><span class="ot">=</span><span class="dv">1</span>, <span class="st">"Fixed Sample"</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">"SSR with CP"</span><span class="ot">=</span><span class="dv">3</span>, <span class="st">"SSR Unblind Control"</span><span class="ot">=</span><span class="dv">3</span>))</span>
<span id="cb18-556"><a href="#cb18-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-557"><a href="#cb18-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-558"><a href="#cb18-558" aria-hidden="true" tabindex="-1"></a>The simulation results indicate:</span>
<span id="cb18-559"><a href="#cb18-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-560"><a href="#cb18-560" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>That the fixed sample design is slightly conservative with type I error of 2%, which is similar to the SSR with unblinded controls at 2.2%, although the sample size increases to an average of 212.6 (SD=39.0). </span>
<span id="cb18-561"><a href="#cb18-561" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The SSR with conditional power is overly conservative, as seen by the lower type I error rates and power compared to the fixed sample design. </span>
<span id="cb18-562"><a href="#cb18-562" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The SSR unblinded control shows the greatest improvement when the control reference is higher than expected (i.e., 30% instead of 25%), where power increases to 72.7% versus 68.9% for a fixed sample design. However, the ESS does increase to 224.6 (SD=51.8) versus 200 for the fixed sample design.</span>
<span id="cb18-563"><a href="#cb18-563" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Some limitations in performance may be due to the fact that our allowed increase is somewhat limited in stage 2 from 100 to 200. In practice, if it was feasible to go higher we could likely improve our power relative to a fixed sample design.</span>
<span id="cb18-564"><a href="#cb18-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-565"><a href="#cb18-565" aria-hidden="true" tabindex="-1"></a>While only a limited set of methods and scenarios with a binary outcome, these results suggest the caution should be taken in implementing sample size re-estimation since it can introduce variability in our needed sample size while also potentially resulting in limited gains in power or type I error performance relative to a fixed sample design.</span>
<span id="cb18-566"><a href="#cb18-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-567"><a href="#cb18-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-568"><a href="#cb18-568" aria-hidden="true" tabindex="-1"></a><span class="fu"># References</span></span>
<span id="cb18-569"><a href="#cb18-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-570"><a href="#cb18-570" aria-hidden="true" tabindex="-1"></a>Below are some references to highlight based on the slides and code:</span>
<span id="cb18-571"><a href="#cb18-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-572"><a href="#cb18-572" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">FDA Adaptive Design Clinical Trials for Drugs and Biologics Guidance for Industry Guidance Document</span><span class="co">](https://www.fda.gov/regulatory-information/search-fda-guidance-documents/adaptive-design-clinical-trials-drugs-and-biologics-guidance-industry)</span>: FDA guidance document on adaptive trial elements</span>
<span id="cb18-573"><a href="#cb18-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-574"><a href="#cb18-574" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Recent innovations in adaptive trial designs: A review of design opportunities in translational research</span><span class="co">](https://www.cambridge.org/core/journals/journal-of-clinical-and-translational-science/article/recent-innovations-in-adaptive-trial-designs-a-review-of-design-opportunities-in-translational-research/614EAFEA5E89CA035E82E152AF660E5D?utm_campaign=shareaholic&amp;utm_medium=copy_link&amp;utm_source=bookmark)</span>: 2023 review paper examining adaptive and novel trial elements with included case studies</span>
<span id="cb18-575"><a href="#cb18-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-576"><a href="#cb18-576" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Guidance on interim analysis methods in clinical trials</span><span class="co">](https://www.cambridge.org/core/journals/journal-of-clinical-and-translational-science/article/guidance-on-interim-analysis-methods-in-clinical-trials/5051FDCF5284970B3DB01FE609AAA4C2?utm_campaign=shareaholic&amp;utm_medium=copy_link&amp;utm_source=bookmark)</span>: 2023 review paper focusing on interim analyses in clinical trials with included case studies</span>
<span id="cb18-577"><a href="#cb18-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-578"><a href="#cb18-578" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Kieser, Meinhard. *Methods and applications of sample size calculation and Recalculation in clinical trials.* Springer, 2020.</span><span class="co">](https://link.springer.com/book/10.1007/978-3-030-49528-2)</span>: textbook covering SSR methods and approaches</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>