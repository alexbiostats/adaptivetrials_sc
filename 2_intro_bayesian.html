<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Bayesian 101</title>

<script src="site_libs/header-attrs-2.27/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />
<link href="site_libs/academicons-1.9.1/css/academicons.css" rel="stylesheet" />

<link rel="icon" type="image/png" href="./files/favicon.ico"/>

<script type="text/javascript">
function setBrand() {
document.getElementsByClassName("navbar-brand")[0].href="https://www.alexkaizer.com";
}
window.onload = setBrand;
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Alex Kaizer</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Short Course
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="0_intro.html">Intro and Welcome</a>
    </li>
    <li>
      <a href="1_intro_clinical_trials.html">Basics of Clinical Trials</a>
    </li>
    <li>
      <a href="2_intro_bayesian.html">Bayesian 101</a>
    </li>
    <li>
      <a href="3_interim_monitoring.html">Interim Monitoring</a>
    </li>
    <li>
      <a href="4_sample_size_reestimation.html">Sample Size Re-Estimation</a>
    </li>
    <li>
      <a href="5_adaptive_enrichment.html">Adaptive Enrichment</a>
    </li>
    <li>
      <a href="6_treatment_arm_selection.html">Treatment Arm Selection</a>
    </li>
    <li>
      <a href="7_adaptive_randomization.html">Adaptive Randomization</a>
    </li>
    <li>
      <a href="8_bayesian_information_sharing.html">Bayesian Information Sharing</a>
    </li>
    <li>
      <a href="9_master_protocols.html">Master Protocols</a>
    </li>
    <li>
      <a href="10_seamless_designs.html">Seamless Designs</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="mailto:alex.kaizer@cuanschutz.edu">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://scholar.google.com/citations?user=ICpH74EAAAAJ&amp;hl=en">
    <span class="ai ai-google-scholar ai-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://www.alexkaizer.com/files/Alex_CV.pdf">
    <span class="ai ai-cv ai-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/alexbiostats">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/AlexBiostats">
    <span class="fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/alex-kaizer/">
    <span class="fab fa-linkedin fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Bayesian 101</h1>

</div>


<div id="overview" class="section level1">
<h1>Overview</h1>
<p>This module covers a crash course in Bayesian statistics. While many
adaptive trial elements can be done with frequentist methods, Bayesian
methods provide additional flexibility. We will introduce the basics of
the Bayesian approach to statistics and cover a brief example analysis
of a clinical trial using Bayesian methods.</p>
</div>
<div id="slide-deck" class="section level1">
<h1>Slide Deck</h1>
<iframe class="speakerdeck-iframe" style="border: 0px; background: rgba(0, 0, 0, 0.1) padding-box; margin: 0px; padding: 0px; border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.2) 0px 5px 40px; width: 100%; height: auto; aspect-ratio: 560 / 315;" frameborder="0" src="https://speakerdeck.com/player/9e2562ed178d47419175ba3647883c01" title="Bayesian 101" allowfullscreen="true" data-ratio="1.7777777777777777">
</iframe>
<p> </p>
<p>You can also download the <a
href="./files/Slides/2_intro_bayesian.pptx">original PowerPoint
file</a>.</p>
</div>
<div id="code-examples-in-r" class="section level1">
<h1>Code Examples in R</h1>
<div id="software-options" class="section level2">
<h2>Software Options</h2>
<p>There are lots of statistical packages and approaches that we can use
to either run Bayesian models in R, or to connect R with external
software to implement the models. Some options include:</p>
<ul>
<li><a href="https://paul-buerkner.github.io/brms/"><code>brms</code>
package</a>: implements the Stan programming language within R, syntax
is similar to the <code>lme4</code> package, this is our focus for
Bayesian examples</li>
<li><a
href="https://mc-stan.org/users/interfaces/rstan"><code>rstan</code> and
<code>rstanarm</code> packages</a>: implements the Stan programming
language within R, <code>rstanarm</code> uses standard <code>glm</code>
syntax, runs more quickly than <code>brms</code> since models are
pre-compiled</li>
<li><a
href="https://easystats.github.io/bayestestR/"><code>bayestestr</code>
package</a>: can provide Bayes factors and works with
<code>rstanarm</code>, <code>brms</code>, and
<code>BayesFactor</code></li>
<li><a
href="https://cran.r-project.org/web/packages/R2jags/index.html"><code>R2jags</code></a>,
<a
href="https://cran.r-project.org/web/packages/rjags/index.html"><code>rjags</code></a>,
<a
href="https://cran.r-project.org/web/packages/runjags/index.html"><code>runjags</code></a>
packages: implements <a href="https://mcmc-jags.sourceforge.io/">JAGS
(just another Gibbs sampler)</a> which allows for non-gradient sampling,
JAGS is one of the “original” approaches for implementing Bayesian
analyses via software (that I remember), can be a little clunkier than
other options</li>
</ul>
<p>It is worth noting that within each software distributions may use
different parameterizations, so caution should be taken to ensure the
desired prior values are used. For example, the normal distribution in
JAGS uses the precision (i.e., <span class="math inline">\(\tau =
\frac{1}{\sigma^2}\)</span>), whereas Stan uses the standard deviation
(i.e., <span class="math inline">\(\sigma\)</span>).</p>
<p>Dr. Kruschke has a nice introduction to Bayesian textbook that
includes some <a
href="https://sites.google.com/site/doingbayesiandataanalysis/software-installation">instructions
for installing software for Bayesian analyses</a>. You may also be
interested in exploring the textbook for more background on Bayesian
theory, methods, and implementation.</p>
<p>Additionally, Stata and SAS (e.g., PROC MCMC and PROC GENMOD) include
Bayesian options. These are detailed in <a
href="https://www.cambridge.org/core/journals/journal-of-clinical-and-translational-science/article/practical-guide-to-adopting-bayesian-analyses-in-clinical-research/CF6C017318CD5431C98EEFE37DBB6063?utm_campaign=shareaholic&amp;utm_medium=copy_link&amp;utm_source=bookmark">“A
practical guide to adopting Bayesian analyses in clinical research”</a>
for step-by-step guidance on their implementation.</p>
</div>
<div
id="linear-regression-code-from-a-practical-guide-to-adopting-bayesian-analyses-in-clinical-research"
class="section level2">
<h2>Linear Regression Code from <a
href="https://www.cambridge.org/core/journals/journal-of-clinical-and-translational-science/article/practical-guide-to-adopting-bayesian-analyses-in-clinical-research/CF6C017318CD5431C98EEFE37DBB6063?utm_campaign=shareaholic&amp;utm_medium=copy_link&amp;utm_source=bookmark">“A
practical guide to adopting Bayesian analyses in clinical
research”</a></h2>
<p>This section provides the code from the published paper in R. The
dataset for the paper is included in the corresponding <a
href="https://github.com/nichole-carlson/BayesianClinicalResearch">GitHub
repository hosted by Dr. Nichole Carlson</a>, but can also be downloaded
as CSV here for convenience: <a
href="./files/drugtrial.csv">drugtrial.csv</a>.</p>
<p>For simplicity, we focus on comparing priors across simple linear
regression models, but the <a
href="https://github.com/nichole-carlson/BayesianClinicalResearch">GitHub
repository</a> includes examples for multiple linear regression and
logistic regression models as well. In this example, we have a
continuous outcome of time to readiness for discharge (in minutes) that
are compared by two randomized treatment groups (sufentanil (new
treatment) versus IV fentanyl).</p>
<p>First, let’s load our packages and read in our data:</p>
<pre class="r"><code># CALL LIBRARIES
library(brms) #Bayesian modeling capabilities
library(bayestestR) #particular Bayesian tests

# READ IN CLINICAL TRIAL DATA FROM PAPER
trial &lt;- read.csv(&#39;files/drugtrial.csv&#39;)

### CHECK OUT TOP ROWS OF DATA
## trial mini-data dictionary:
# rowid: trial ID
# in_phase_1_to_out_of_phase_2: time to readiness for discharge after arrival in PACU (minutes)
# sex_n: sex of participant (1=female, 0=male)
# groupn: randomized group (1=sufentanil, 0=IV fentanyl)
# blockn: preoperative nerve block used (1=yes, 0=no)
# proc_length_center: procedure length (minutes)

head(trial)</code></pre>
<pre><code>##   rowid in_phase_1_to_out_of_phase_2 sex_n groupn blockn proc_length_center
## 1     1                           60     1      0      0              -37.8
## 2     2                           69     1      1      1              -10.8
## 3     3                          102     1      1      0              -57.8
## 4     4                          165     1      0      0               22.2
## 5     5                          115     1      1      0              140.2
## 6     6                          104     0      0      1               21.2</code></pre>
<div id="frequentist-simple-linear-regression" class="section level3">
<h3>Frequentist Simple Linear Regression</h3>
<p>For comparison sake, we can first fit our frequentist simple linear
regression using the <code>glm</code> function:</p>
<pre class="r"><code># Syntax: &lt;name of model object&gt; &lt;- glm(&lt;outcome variable&gt; ~ &lt;predictor variable&gt;, data = &lt;datasetname&gt;, family=&lt;distribution corresponding to model type&gt;) 
lin_reg &lt;- glm(in_phase_1_to_out_of_phase_2 ~ groupn, 
               data=trial, 
               family=&#39;gaussian&#39;)

# Syntax: summary(&lt;model object&gt;) - function to show model parameter estimates/results
summary(lin_reg)</code></pre>
<pre><code>## 
## Call:
## glm(formula = in_phase_1_to_out_of_phase_2 ~ groupn, family = &quot;gaussian&quot;, 
##     data = trial)
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   94.364      5.289  17.842   &lt;2e-16 ***
## groupn         3.727      7.480   0.498     0.62    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for gaussian family taken to be 923.0682)
## 
##     Null deviance: 59306  on 65  degrees of freedom
## Residual deviance: 59076  on 64  degrees of freedom
## AIC: 641.9
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<pre class="r"><code># Syntax: confint() - print confidence intervals in console
confint(lin_reg)</code></pre>
<pre><code>##                 2.5 %   97.5 %
## (Intercept)  83.99771 104.7296
## groupn      -10.93236  18.3869</code></pre>
</div>
<div id="brms-bayesian-simple-linear-regression-syntax"
class="section level3">
<h3>brms Bayesian Simple Linear Regression Syntax</h3>
<p>The general syntax for using <code>brm</code> is described below:</p>
<pre class="r"><code># Syntax: using brm function for Bayesian modeling
#   &lt;name of model object&gt; &lt;- brm(&lt;outcome variable&gt; ~ &lt;predictor variable&gt;, 
#            data = &lt;datasetname&gt;, 
#            family=&lt;distribution corresponding to model type&gt;,
#            prior = c(set_prior(&quot;&lt;distribution(mean,SD)&quot;, class = &quot;&lt;name&gt;&quot;)),
#            seed = &lt;value - for reproducibility&gt;,
#            init = &lt;name of initial values list&gt;,
#            warmup = &lt;sets the # of burn-in iterations (those that will be &#39;thrown out&#39;)&gt;,
#            iter = &lt;# of total iterations for each chain including burn-in&gt;
#            chains = &lt;# of chains&gt;,
#            cores = &lt;#&gt; to use for executing chains in parallel - for processing)</code></pre>
<p>We also will create a set of initial values to use for each our
simple linear regressions below:</p>
<pre class="r"><code># Set initial starting values for chains by creating a list, will be used for all simple linear regressions
# Syntax: list(&lt;model parameter&gt; = &lt;starting value&gt;); be sure to list all parameters
inits &lt;- list(
  Intercept = 0,
  sigma     = 1,
  beta      = 0 )

# Syntax: &lt;new_list&gt; &lt;- list(&lt;initial values list name&gt;) - Create list of all initial values
list_of_inits &lt;- list(inits, inits, inits)</code></pre>
</div>
<div id="brms-slr-with-pseudo-vague-prior" class="section level3">
<h3>brms SLR with Pseudo Vague Prior</h3>
<p>In this example, we fit a “pseudo-vague” prior where <span
class="math inline">\(\sigma^2 = 1000\)</span> or, equivalently, <span
class="math inline">\(\sigma = \sqrt{1000} = 31.62278\)</span>. Here we
call the prior “pseudo-vague” because it turns out that while it seems
like a <em>large</em> variance, since <span
class="math inline">\(\beta_0 \sim N(\mu=0, \sigma=31.62278)\)</span>,
there is some biasing towards a mean of 0.</p>
<pre class="r"><code>fit_lin_1 &lt;-brm(in_phase_1_to_out_of_phase_2 ~ groupn,
                data=trial,
                family=&#39;gaussian&#39;,
                prior = c(set_prior(&quot;normal(0,31.62278)&quot;, class = &quot;b&quot;),
                          set_prior(&quot;normal(0,31.62278)&quot;, class =&quot;Intercept&quot;),
                          set_prior(&quot;inv_gamma(0.01,0.01)&quot;, class=&quot;sigma&quot;)),
                seed= 123,
                init=list_of_inits,
                warmup = 1000, iter = 10000, chains = 2, cores=4,
                save_pars = save_pars(all = TRUE))

# Summarize parameters
summary(fit_lin_1)</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: in_phase_1_to_out_of_phase_2 ~ groupn 
##    Data: trial (Number of observations: 66) 
##   Draws: 2 chains, each with iter = 10000; warmup = 1000; thin = 1;
##          total post-warmup draws = 18000
## 
## Regression Coefficients:
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    93.05      5.34    82.48   103.53 1.00    18799    13379
## groupn        3.55      7.42   -10.90    18.16 1.00    17970    13260
## 
## Further Distributional Parameters:
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    30.71      2.75    25.89    36.59 1.00    19382    13421
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<pre class="r"><code># Obtain highest density posterior interval
bayestestR::hdi(fit_lin_1, ci=0.95) </code></pre>
<pre><code>## Highest Density Interval
## 
## Parameter   |          95% HDI
## ------------------------------
## (Intercept) | [ 82.66, 103.66]
## groupn      | [-10.79,  18.24]</code></pre>
<pre class="r"><code># Syntax: plot() - print Bayesian diagnostic plots to console, plots in one figure
plot(fit_lin_1)</code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-pseudo-vague-prior-1.png" width="672" /></p>
<pre class="r"><code># Request plots individually 
mcmc_plot(fit_lin_1, type=&quot;hist&quot;) #histogram</code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-pseudo-vague-prior-2.png" width="672" /></p>
<pre class="r"><code>mcmc_plot(fit_lin_1, type=&quot;trace&quot;) #trace plot</code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-pseudo-vague-prior-3.png" width="672" /></p>
<pre class="r"><code>mcmc_plot(fit_lin_1, type=&quot;acf&quot;) #autocorrelation plot</code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-pseudo-vague-prior-4.png" width="672" /></p>
<pre class="r"><code># Syntax: prior_summary() - print priors used in console
prior_summary(fit_lin_1)</code></pre>
<pre><code>##                 prior     class   coef group resp dpar nlpar lb ub       source
##    normal(0,31.62278)         b                                            user
##    normal(0,31.62278)         b groupn                             (vectorized)
##    normal(0,31.62278) Intercept                                            user
##  inv_gamma(0.01,0.01)     sigma                               0            user</code></pre>
<pre class="r"><code># Extract posterior chains
post_samp &lt;- as_draws(fit_lin_1)

# Combine and extract drug group posterior estimates (can add more list items if more than 2 chains)
xpost &lt;- c(post_samp[[1]]$b_groupn, post_samp[[2]]$b_groupn) 

# Calculate the posterior probability that our group predictor is less than 0
mean(xpost &lt; 0) </code></pre>
<pre><code>## [1] 0.3167222</code></pre>
</div>
<div id="brms-slr-with-vague-prior" class="section level3">
<h3>brms SLR with Vague Prior</h3>
<p>In this example, we fit a “vague” prior where <span
class="math inline">\(\sigma^2 = 10000\)</span> or, equivalently, <span
class="math inline">\(\sigma = \sqrt{100} = 100\)</span>.</p>
<pre class="r"><code>fit_lin_2 &lt;- brm(in_phase_1_to_out_of_phase_2 ~ groupn, 
                 data=trial, 
                 family=&#39;gaussian&#39;, 
                 prior = c(set_prior(&quot;normal(0,100)&quot;, class = &quot;b&quot;),
                           set_prior(&quot;normal(0,100)&quot;, class = &quot;Intercept&quot;),
                           set_prior(&quot;inv_gamma(0.01,0.01)&quot;, class=&quot;sigma&quot;)),
                 seed= 123,
                 init=list_of_inits,
                 warmup = 1000, iter = 10000, chains = 2, cores=4)

summary(fit_lin_2)</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: in_phase_1_to_out_of_phase_2 ~ groupn 
##    Data: trial (Number of observations: 66) 
##   Draws: 2 chains, each with iter = 10000; warmup = 1000; thin = 1;
##          total post-warmup draws = 18000
## 
## Regression Coefficients:
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    94.28      5.43    83.71   105.04 1.00    16878    12729
## groupn        3.63      7.60   -11.51    18.32 1.00    17708    11472
## 
## Further Distributional Parameters:
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    30.74      2.75    25.89    36.61 1.00    17210    13095
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<pre class="r"><code>bayestestR::hdi(fit_lin_2, ci=0.95) </code></pre>
<pre><code>## Highest Density Interval
## 
## Parameter   |          95% HDI
## ------------------------------
## (Intercept) | [ 83.20, 104.45]
## groupn      | [-11.06,  18.71]</code></pre>
<pre class="r"><code>plot(fit_lin_2)</code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-vague-prior-1.png" width="672" /></p>
<pre class="r"><code>mcmc_plot(fit_lin_2, type=&quot;hist&quot;) </code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-vague-prior-2.png" width="672" /></p>
<pre class="r"><code>mcmc_plot(fit_lin_2, type=&quot;trace&quot;) </code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-vague-prior-3.png" width="672" /></p>
<pre class="r"><code>mcmc_plot(fit_lin_2, type=&quot;acf&quot;) </code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-vague-prior-4.png" width="672" /></p>
<pre class="r"><code>prior_summary(fit_lin_2)</code></pre>
<pre><code>##                 prior     class   coef group resp dpar nlpar lb ub       source
##         normal(0,100)         b                                            user
##         normal(0,100)         b groupn                             (vectorized)
##         normal(0,100) Intercept                                            user
##  inv_gamma(0.01,0.01)     sigma                               0            user</code></pre>
<pre class="r"><code># OPTION 1 for calculating posterior probabilities:
# Extract posterior chains
post_samp2 &lt;- as_draws(fit_lin_2)
xpost2 &lt;- c(post_samp2[[1]]$b_groupn, post_samp2[[2]]$b_groupn) 

# Calculate the posterior probability that our group predictor is less than 0
mean(xpost2 &lt; 0) </code></pre>
<pre><code>## [1] 0.3117778</code></pre>
<pre class="r"><code># OPTION 2 for calculating posterior probabilities:
# Extract posterior chains
post_samp2 &lt;- as_draws_df(fit_lin_2)

# Create an indicator for group &lt; 0
post_samp2$indicator &lt;- post_samp2$b_groupn&lt;0

# Calculate the posterior probability
summary(post_samp2$indicator)</code></pre>
<pre><code>##    Mode   FALSE    TRUE 
## logical   12388    5612</code></pre>
</div>
<div id="brms-slr-with-optimistic-prior" class="section level3">
<h3>brms SLR with Optimistic Prior</h3>
<p>In this example, we fit an “optimistic” prior on our treatment group
such that <span class="math inline">\(\beta_1 \sim N(\mu=-30,
\sigma=10)\)</span>. This was selected based on the estimates used for
the power analysis in the original trial where it was estimated that a
clinically meaningful difference would be a 30 minute reduction in
readiness to discharge.</p>
<pre class="r"><code>fit_lin_3 &lt;- brm(in_phase_1_to_out_of_phase_2 ~ groupn, 
                 data=trial, 
                 family=&#39;gaussian&#39;, 
                 prior = c(set_prior(&quot;normal(-30,10)&quot;, class = &quot;b&quot;, coef = &quot;groupn&quot;),
                           set_prior(&quot;normal(0,100)&quot;, class = &quot;Intercept&quot;),
                           set_prior(&quot;inv_gamma(0.01,0.01)&quot;, class=&quot;sigma&quot;)),
                 seed= 123,
                 init=list_of_inits,
                 warmup = 1000, iter = 10000, chains = 2, cores=4)
summary(fit_lin_3)</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: in_phase_1_to_out_of_phase_2 ~ groupn 
##    Data: trial (Number of observations: 66) 
##   Draws: 2 chains, each with iter = 10000; warmup = 1000; thin = 1;
##          total post-warmup draws = 18000
## 
## Regression Coefficients:
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept   100.48      4.99    90.87   110.33 1.00    14460    12578
## groupn       -8.79      6.24   -21.28     3.14 1.00    14788    12967
## 
## Further Distributional Parameters:
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    31.33      2.86    26.32    37.54 1.00    15824    13469
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<pre class="r"><code>bayestestR::hdi(fit_lin_3, ci=0.95) #get 95% HDP Credible Intervals</code></pre>
<pre><code>## Highest Density Interval
## 
## Parameter   |          95% HDI
## ------------------------------
## (Intercept) | [ 90.51, 109.89]
## groupn      | [-20.89,   3.41]</code></pre>
<pre class="r"><code>plot(fit_lin_3)</code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-optimistic-prior-1.png" width="672" /></p>
<pre class="r"><code>mcmc_plot(fit_lin_3, type=&quot;hist&quot;) </code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-optimistic-prior-2.png" width="672" /></p>
<pre class="r"><code>mcmc_plot(fit_lin_3, type=&quot;trace&quot;) </code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-optimistic-prior-3.png" width="672" /></p>
<pre class="r"><code>mcmc_plot(fit_lin_3, type=&quot;acf&quot;) </code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-optimistic-prior-4.png" width="672" /></p>
<pre class="r"><code>prior_summary(fit_lin_3)</code></pre>
<pre><code>##                 prior     class   coef group resp dpar nlpar lb ub  source
##                (flat)         b                                    default
##        normal(-30,10)         b groupn                                user
##         normal(0,100) Intercept                                       user
##  inv_gamma(0.01,0.01)     sigma                               0       user</code></pre>
<pre class="r"><code># Extract posterior chains
post_samp3 &lt;- as_draws(fit_lin_3)

xpost3 &lt;- c(post_samp3[[1]]$b_groupn, post_samp3[[2]]$b_groupn) 

# Calculate the posterior probability that our group predictor is less than 0
mean(xpost3 &lt; 0) </code></pre>
<pre><code>## [1] 0.9235</code></pre>
</div>
<div id="brms-slr-with-skeptical-prior" class="section level3">
<h3>brms SLR with Skeptical Prior</h3>
<p>In this example, we fit a “skeptical” prior on our treatment group
such that <span class="math inline">\(\beta_1 \sim N(\mu=0,
\sigma=10)\)</span>. This prior represents a skeptics belief that there
is a meaningful treatment difference by centering the treatment effect
at 0 with smaller variance than our vague prior.</p>
<pre class="r"><code>fit_lin_4 &lt;- brm(in_phase_1_to_out_of_phase_2 ~ groupn, 
                 data=trial, 
                 family=&#39;gaussian&#39;, 
                 prior = c(set_prior(&quot;normal(0,10)&quot;, class = &quot;b&quot;, coef = &quot;groupn&quot;),
                           set_prior(&quot;normal(0,100)&quot;, class = &quot;Intercept&quot;),
                           set_prior(&quot;inv_gamma(0.01,0.01)&quot;, class=&quot;sigma&quot;)),
                 seed= 123,
                 init=list_of_inits,
                 warmup = 1000, iter = 10000, chains = 2, cores=4)

summary(fit_lin_4)</code></pre>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: in_phase_1_to_out_of_phase_2 ~ groupn 
##    Data: trial (Number of observations: 66) 
##   Draws: 2 chains, each with iter = 10000; warmup = 1000; thin = 1;
##          total post-warmup draws = 18000
## 
## Regression Coefficients:
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    94.95      4.92    85.27   104.53 1.00    18329    12418
## groupn        2.27      5.98    -9.59    14.05 1.00    17125    13003
## 
## Further Distributional Parameters:
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma    30.66      2.73    25.90    36.53 1.00    16139    13918
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<pre class="r"><code>bayestestR::hdi(fit_lin_4, ci=0.95) #get 95% HDP Credible Intervals</code></pre>
<pre><code>## Highest Density Interval
## 
## Parameter   |         95% HDI
## -----------------------------
## (Intercept) | [85.18, 104.41]
## groupn      | [-9.22,  14.32]</code></pre>
<pre class="r"><code>plot(fit_lin_4)</code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-skeptical-prior-1.png" width="672" /></p>
<pre class="r"><code>mcmc_plot(fit_lin_4, type=&quot;hist&quot;) </code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-skeptical-prior-2.png" width="672" /></p>
<pre class="r"><code>mcmc_plot(fit_lin_4, type=&quot;trace&quot;) </code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-skeptical-prior-3.png" width="672" /></p>
<pre class="r"><code>mcmc_plot(fit_lin_4, type=&quot;acf&quot;) </code></pre>
<p><img src="2_intro_bayesian_files/figure-html/brms-slr-skeptical-prior-4.png" width="672" /></p>
<pre class="r"><code>prior_summary(fit_lin_4)</code></pre>
<pre><code>##                 prior     class   coef group resp dpar nlpar lb ub  source
##                (flat)         b                                    default
##          normal(0,10)         b groupn                                user
##         normal(0,100) Intercept                                       user
##  inv_gamma(0.01,0.01)     sigma                               0       user</code></pre>
<pre class="r"><code># Extract posterior chains
post_samp4 &lt;- as_draws(fit_lin_4)

xpost4 &lt;- c(post_samp4[[1]]$b_groupn, post_samp4[[2]]$b_groupn) 

# Calculate the posterior probability that our group predictor is less than 0
mean(xpost4 &lt; 0) </code></pre>
<pre><code>## [1] 0.3480556</code></pre>
</div>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Below are some references to highlight based on the slides and
code:</p>
<ul>
<li><a
href="https://www.cambridge.org/core/journals/journal-of-clinical-and-translational-science/article/practical-guide-to-adopting-bayesian-analyses-in-clinical-research/CF6C017318CD5431C98EEFE37DBB6063?utm_campaign=shareaholic&amp;utm_medium=copy_link&amp;utm_source=bookmark">A
practical guide to adopting Bayesian analyses in clinical research</a>:
2024 tutorial paper exploring the Bayesian approach to statistics and
how to apply the methods for clinical trials</li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
